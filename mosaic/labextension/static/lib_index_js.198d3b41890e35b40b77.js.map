{"version":3,"file":"lib_index_js.198d3b41890e35b40b77.js","mappings":"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","sources":["webpack://mosaic/./src/MosaicGroup.ts","webpack://mosaic/./src/MosaicNotebookPanel.ts","webpack://mosaic/./src/MosaicViewModel.ts","webpack://mosaic/./src/index.ts","webpack://mosaic/./src/mosaicdrag.ts"],"sourcesContent":["import { Notebook, NotebookPanel, NotebookWindowedLayout } from '@jupyterlab/notebook';\nimport { WindowedList } from '@jupyterlab/ui-components';\nimport { Message } from '@lumino/messaging';\n// import { ChildMessage } from '@lumino/widgets';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { Cell, CodeCell, MarkdownCell,  } from '@jupyterlab/cells';\nimport { ArrayExt } from '@lumino/algorithm';\nimport { ObservableList, IObservableList } from '@jupyterlab/observables';\n\nimport { MosaicViewModel } from './MosaicViewModel';\nimport { MosaicNotebook } from './MosaicNotebookPanel';\n\nimport { runIcon } from '@jupyterlab/ui-components';\n// import { Widget } from '@lumino/widgets';\n// import { MosaicNotebook } from './MosaicNotebookPanel';\n\n// import InArrows from '../style/icons/in-arrows.svg';\n// import OutArrows from '../style/icons/out-arrows.svg';\n// const MOSAIC_ICON_PATH = '../style/icons/mosaic-icon.svg';\n\n// import { LabIcon } from '@jupyterlab/ui-components';\n\n// const InArrowsIcon = new LabIcon({ name: 'mosaic:favicon', svgstr: InArrows.toString()});\n// const OutArrowsIcon = new LabIcon({ name: 'mosaic:favicon', svgstr: OutArrows.toString()});\n\nexport type FlexDirection = 'row' | 'col';\n\nexport type Tile = LeafCell | Mosaic;\n\nexport class LeafCell extends Cell {\n    public superMosaic: Mosaic | null = null; // mosaic tree awareness, track parent\n}\n\n// export type NestedObservableList<T> = IObservableList<T | NestedObservableList<T>>;\nexport class ObservableTree<T> extends ObservableList<T> {\n    constructor() {\n        super();\n        this.changed.connect((sender: ObservableTree<T>, msg: IObservableList.IChangedArgs<T>) => {\n            // TODO - propagate changes up (add and modify listeners on children?)\n        }); \n    }\n    splice(startIndex: number, replaceCount:number, ...values: Array<T>): Array<T> {\n        const removed = [];\n        for (let n = 0; n < replaceCount; n++) {\n            removed.push(this.remove(startIndex));\n        }\n        for (let i = 0; i < values.length; i++) {\n            this.insert(startIndex+i, values[i]);\n        }\n        return removed as Array<T>;\n    }\n    map(callback: Function): Array<any> {\n        const out = [];\n        for (let i = 0; i < this.length; i++) {\n            out.push(callback(this.get(i)));\n        }\n        return out;\n    }\n    indexOf(value: T): number {\n        const itemCmp = (this as any)._itemCmp;\n        return ArrayExt.findFirstIndex((this as any)._array, (item: T) => {\n            return itemCmp(item, value);\n        });\n    }\n    removeValue(value: T): number {\n    const itemCmp = (this as any)._itemCmp;\n    const index = ArrayExt.findFirstIndex((this as any)._array, (item: T) => {\n      return itemCmp(item, value);\n    });\n    if (index < 0) return index;\n    this.remove(index);\n    return index;\n  }\n}\n\n// class ReparentableNotebookWindowedLayout extends NotebookWindowedLayout {\n//     protected detachWidget(index: number, widget: Widget): void {\n//         // don't execute detachment procedures if the widget has been moved to some other parent.\n//         // otherwise a race condition arises hiding or showing the element depending on if\n//         // reciever or donor parent updates first.\n//         if (widget.isAttached && widget.parent && widget.parent !== this.parent) return;\n//         console.log(widget, widget.parent, this, this.parent);\n//         super.detachWidget(index, widget);\n//     }\n// }\n\nexport class Mosaic extends WindowedList<MosaicViewModel> { // like a cell (element in notebook), but also like a windowedlist/notebook (contains more cells)\n    static METADATA_NAME = 'mosaic';\n    static NODE_CLASS = 'mosaic-group-outer';\n    static INNER_GROUP_CLASS = 'mosaic-group-inner';\n    static DIR_CLASS = {\n        'row': 'mosaic-row',\n        'col': 'mosaic-col'\n    }\n    static CSS = {\n        rowPaddingTop: 5,\n        colPaddingLeft: 5\n    }\n    static defaultConfig = {\n        overscanCount: 3\n    }\n    \n    \n    protected _superMosaic: Mosaic | MosaicNotebook | null = null;\n    public tiles: ObservableTree<Tile>;\n    public mosaics: Map<string, Mosaic>;\n    protected _direction: FlexDirection;\n    public runButton: HTMLElement | null = null;\n\n    // can be hidden in super-windowed-list, like cell.\n    private _placeholder: boolean;\n    private _ready = new PromiseDelegate<void>();\n    constructor(public groupID: string, direction: FlexDirection = 'col') {\n        const tiles: ObservableTree<Tile> = new ObservableTree();\n        super({\n            model: new MosaicViewModel(tiles, direction, {\n                overscanCount: //options.notebookConfig?.overscanCount  ??\n                    Mosaic.defaultConfig.overscanCount,\n                windowingActive: true\n            }),\n            layout: new NotebookWindowedLayout(), //ReparentableNotebookWindowedLayout(),\n            renderer: /*options.renderer ??*/ WindowedList.defaultRenderer,\n            scrollbar: false\n        });\n        // this.notebook = options.notebook;\n        this.tiles = tiles;\n        this.mosaics = new Map<string, Mosaic>();\n        this._direction = direction;\n        // this.direction = options.direction;\n        this._placeholder = true;\n\n        this.addClass(Mosaic.NODE_CLASS);\n\n        this.tiles.changed.connect(this.onTreeChanged, this);\n\n        // patch the item resize method to use width not height when in row mode\n        (this as any)._onItemResize = this.onItemResize;\n\n        (this as any)._updateTotalSize = this.updateTotalSize;\n\n\n        this.viewportNode.addEventListener('scroll', (e: Event) => {\n            this.onScroll(e);\n            e.stopPropagation();\n        });\n        this.viewportNode.addEventListener('scrollend', (e: Event) => {\n            this.updateOverflowShadow();\n            e.stopPropagation();\n        });\n\n    }\n\n    get notebook(): Notebook | undefined {\n        // traverse up the tree to get the notebook\n        return this.superMosaic!.notebook;\n    }\n\n    get direction() {\n        return this._direction;\n    }\n    set direction(d: FlexDirection) {\n        this._direction = d;\n    }\n\n    get superMosaic(): Mosaic | MosaicNotebook | null {\n        return this._superMosaic;\n    }\n    set superMosaic(mosaic: Mosaic | MosaicNotebook | null) {\n        if (this._superMosaic !== null && mosaic !== this._superMosaic) {\n            this._superMosaic!.tiles.removeValue(this);\n        }\n        this._superMosaic = mosaic;\n    }\n\n    get path(): Array<string> {\n        return [...(this.superMosaic !== null ? this.superMosaic.path : []), this.groupID];\n    }\n\n\n    get id() {\n        return `mosaic:${this.path.join('/')}`;\n    }\n    saveState(state: any) {\n        this.notebook!.model!.setMetadata(this.id, state);\n    }\n    getState() {\n        return this.notebook!.model!.getMetadata(this.id) || {};\n    }\n\n\n    onTreeChanged(tree:ObservableTree<Tile>, msg:IObservableList.IChangedArgs<Tile>): void {\n        switch (msg.type) {\n            // case 'set':\n            case 'clear':\n            case 'remove': {\n                // for (const tile of msg.oldValues) {\n                    // console.warn('removing', tile);\n                    // if (tile instanceof Mosaic) {\n                    //     this.mosaics.delete(tile.groupID);\n                    // }\n                // }\n                setTimeout(() => { // timeout in case cell moved (removed then added). Don't unwrap unless its staying underpopulated.\n                    this.checkEmpty();\n                }, 250);\n                break;\n            }\n            case 'set':\n            case 'add': {\n                for (const tile of msg.newValues) {\n                    Mosaic.setParent(tile, this);\n                    if (tile instanceof Mosaic) {\n                    //     console.log('adding ', 'Mosaic:'+tile.groupID);\n                    //     this.mosaics.set(tile.groupID, tile);\n                    }\n                    else if (tile instanceof Cell) {\n                        Mosaic.setPath(tile, this.path);\n                        // console.log('adding ', 'Cell:'+(tile as any).prompt);\n                        tile.disposed.connect((cell:LeafCell, msg:any)=> {\n                            setTimeout(() => this.checkEmpty(), 250); // allow timeout for cells to be re-added, so it doesn't collapse when moving a cell\n                        });\n\n                    }\n                }\n                break;\n            }\n        }\n\n        requestAnimationFrame(() => this.update());\n\n        // trigger update on super tree for this item\n        if (this.superMosaic) {\n            const idx = this.superMosaic.tiles.indexOf(this);\n            if (idx > -1) this.superMosaic.onTreeChanged(this.superMosaic.tiles, {\n                type: 'set',\n                newIndex: idx,\n                newValues: [this],\n                oldIndex: idx,\n                oldValues: [this]\n            });\n        }\n    }\n\n\n    \n\n    treeGet(path: Array<string>, depth: number = 0): Mosaic {\n        if (depth < path.length) {\n            return (this.mosaics.get(path[depth]) as Mosaic).treeGet(path, depth+1);\n        }\n        return this; // i am at a depth == path length, I am the result\n    }\n\n    treeGetExisting(path: Array<string>, depth: number = 0): [Mosaic, number] {\n        // get up to the deepest existing branch for the given path\n        if (depth < path.length) {\n            const nextBranch = (this.mosaics.get(path[depth]));\n            if (nextBranch !== undefined) {\n                return (nextBranch as Mosaic).treeGetExisting(path, depth+1);\n            } else {\n                return [this, depth];\n            }\n        }\n        return [this, depth];\n    }\n\n\n\n    // insertLeaf(branch: Mosaic, cell: Cell, idx: number = 0) {\n    // }\n    addTile(groupID: string = '', index: number = -1): Mosaic {\n        if (groupID == '') groupID = Mosaic.newUGID();\n        const newMosaic = new Mosaic(groupID);//, this.options);\n        this.splice(index, 0, newMosaic);\n        return newMosaic;\n    }\n    growBranch(path: Array<string>, branchsIxs: Array<number> = [], depth: number = 0): Mosaic {\n        if (depth < path.length) {\n            let nextBranch = (this.mosaics.get(path[depth]));\n            if (nextBranch == undefined) {\n                nextBranch = this.addTile(path[depth], (branchsIxs.length > depth ? branchsIxs[depth] : -1));\n            }\n            return (nextBranch as Mosaic).growBranch(path, branchsIxs, depth+1);\n        }\n        return this;\n    }\n\n    // removeLast(tile: Tile) {\n    //     const ix = ArrayExt.lastIndexOf(this.tiles, tile);\n    //     this.splice(ix, 1);\n    //     // this.checkEmpty();\n    // }\n\n    splice(startIndex: number, replaceCount: number, ...tiles: Array<Tile>) {\n        if (startIndex < 0) startIndex = this.tiles.length;\n        this.tiles.splice(startIndex, replaceCount, ...tiles);\n    }\n\n    checkEmpty() {\n        // unwrap if only holding one or no tiles\n        if (this.tiles.length < 2) {\n            const subtile = this.tiles.get(0);\n            if (subtile && subtile instanceof Mosaic) {\n                subtile.unwrap(); // remove double-wrap (to preserve flex direction)\n            }\n            this.unwrap();\n        }\n    }\n\n\n    unwrap() {\n        if (!this.superMosaic) return;\n\n        // remove self from superMosaic\n        const idx = this.superMosaic.tiles.removeValue(this); // I am now dereferrenced, I should be garbage collected.\n        // console.log('unwrapping:', this.path, Mosaic.showMosaic(this), 'index in super:', idx, this.superMosaic);\n        if (this.tiles.length > 0) { // insert my contents (if any) where I was\n            console.log('im not empty');\n            this.superMosaic.tiles.splice(idx, 0, ...this.tiles);\n            console.log('gave to parent:', Mosaic.showMosaic(this.superMosaic as Mosaic));\n        }\n    }\n\n    getLeaf(leafIx: number): [[Mosaic, LeafCell] | null, number] {\n        // linearly walk through leafs (Cells) according to each sub groups order until the desired leafindex is reached\n        // returns: last parent mosaic and id of leaf in parent or null if not found, and index of leaf in parent, (or total number of leaves if not found)\n        let i = 0;\n        for (const tile of this.tiles) {\n            if (tile instanceof Cell) {\n                if (i == leafIx) {\n                    return [[this, tile], i]; // found desired leaf\n                }\n                i += 1; // count leaf\n            } else { // branch\n                const [stemAndLeaf, leafNum] = tile.getLeaf(leafIx-i);\n\n                if (stemAndLeaf !== null) {\n                    return [stemAndLeaf, leafNum];\n                }\n                i += leafNum!; // count all leaves from this branch\n            }\n        }\n        return [null, i]; // nLeafs > number of leaves I have\n    }\n\n    findGroup(node: Node): Array<string> | null {\n        // search the tree depth-first for a mosaic group with the specified node\n        for (const groupID in this.mosaics) {\n            if (this.mosaics.get(groupID)!.node === node) {\n                return [groupID];\n            }\n            const found = this.mosaics.get(groupID)!.findGroup(node);\n            if (found !== null) {\n                return [groupID, ...found];\n            }\n        }\n        return null;\n    }\n\n    // findStem(leaf: Cell, reverse = true): Mosaic | null {\n    //     let list;\n    //     if (reverse) list = this.tiles.slice().reverse();\n    //     else list = this.tiles;\n\n    //     for (const tile of list) {\n    //         if (tile instanceof Cell) {\n    //             if (tile === leaf) return this;\n    //         } else {\n    //             return tile.findStem(leaf, reverse);\n    //         }\n    //     }\n    //     return null;\n    // }\n\n\n\n    \n    \n\n\n\n\n\n\n\n    /* based on @jupyterlab/cells/Cell */\n\n    isPlaceholder(): boolean {\n        return this.placeholder;\n    }\n\n    get placeholder(): boolean {\n        return this._placeholder;\n    }\n\n    protected set placeholder(v: boolean) {\n        console.warn('PLACEHOLDER SET');\n        if (this._placeholder !== v && v === false) {\n            this.initializeDOM();\n            this._placeholder = v;\n            this._ready.resolve();\n        }\n    }\n\n    protected initializeDOM(): void {\n        console.log('INITIALIZING DOM');\n        if (!this.placeholder) {\n            return;\n        }\n\n    }\n\n    get ready(): Promise<void> {\n        return this._ready.promise;\n    }\n\n\n    async runAll() {\n        for (const tile of this.tiles) {\n            if (tile instanceof Mosaic) {\n                tile.runAll();\n            }\n            else if (tile instanceof Cell) {\n                if (!this.notebook) return console.warn('No notebook! Cannot run cells');\n                const context = (this.notebook?.parent as NotebookPanel).sessionContext\n                if (tile instanceof CodeCell) {\n                    try {\n                        await CodeCell.execute(tile, context);\n                    } catch (e) {\n                        console.error('Cell exec err', e);\n                    }\n                } else if (tile instanceof MarkdownCell) {\n                    tile.rendered = true;\n                }\n            }\n        }\n    }\n\n    /** Notebook-like methods */\n\n    public onAfterAttach(msg: Message): void {\n        this.update(); // will attach inner cells according to viewModel widgetRenderer\n        super.onAfterAttach(msg);\n\n        this.direction = (this.parent as Mosaic).direction == 'col' ? 'row' : 'col', // invert direction of parent \n        // console.log('attached as', this.direction, 'to',  this.parent, (this.parent as Mosaic).direction);\n        this.viewModel.direction = this.direction;\n\n        this.viewportNode.classList.add(Mosaic.INNER_GROUP_CLASS, Mosaic.DIR_CLASS[this.direction]);\n\n        this.updateOverflowShadow(); // update shadowing baased on scroll\n\n        if (!this.runButton) {\n            this.runButton = document.createElement('div');\n            this.runButton.appendChild(runIcon.element());\n            this.runButton.classList.add('mosaic-group-run-btn');\n            this.runButton.onclick = () => this.runAll();\n        }\n        this.node.appendChild(this.runButton);\n\n        // drag in the gaps of a row to resize elements\n        const w = this.getState().elWidth;\n        if (Number.isFinite(w)) this.setElWidth(w);\n        let dragging = false;\n        this.node.onmousedown = (ev: MouseEvent) => {\n            if (ev.target === this.viewportNode) dragging = true;\n        }\n        const endDrag = (ev: MouseEvent) => {\n            dragging = false;\n            if (this.direction == 'row') {\n                const elWidth = this.layout.widgets[0].node.getBoundingClientRect().width;\n                this.saveState({...this.getState(), elWidth});\n            }\n        }\n        this.node.onmouseleave = endDrag;\n        this.node.onmouseup = endDrag;\n        this.node.onmousemove = (ev: MouseEvent) => {\n            if (dragging && this.direction == 'row') {\n                const oldWidth = this.layout.widgets[0].node.getBoundingClientRect().width;\n                this.setElWidth(oldWidth+ev.movementX);\n            }\n        }\n    }\n\n    protected setElWidth(width: number) {\n        this.node.style.setProperty('--el-width', `${width}px`);\n    }\n\n\n    protected onScroll(event: Event): void {\n        super.onScroll(event);\n        // super onScroll updates the viewModels scrollOffset with the scrollTop\n        // we have horizontal windowedlists, in which case we need to do the same but with scrollLeft:\n        if (this.direction == 'row') {\n            const { clientWidth, scrollWidth, scrollLeft } = event.currentTarget as HTMLDivElement;\n\n            if (\n                Math.abs(this.viewModel.scrollOffset - scrollLeft) > 1\n            ) {\n                const scrollOffset = Math.max(\n                    0,\n                    Math.min(scrollLeft, scrollWidth - clientWidth)\n                );\n                this.viewModel.scrollOffset = scrollOffset;\n\n                if (this.viewModel.windowingActive) {\n                    this.update();\n                }\n            }\n        }\n    }\n    protected updateOverflowShadow(): void {\n        // tag things scrolled all the way to one side, so CSS styling shows shadow on overflowing elements\n        if (this.direction == 'col') {\n            if (this.viewportNode.scrollTop < 10) {\n                this.dataset.mosaicScrolledSide = 'top';\n            }\n            else if (this.viewportNode.scrollTop > this.viewportNode.scrollHeight-this.viewportNode.clientHeight-10) {\n                this.dataset.mosaicScrolledSide = 'bottom';\n            } else {\n                this.dataset.mosaicScrolledSide = '';\n            }\n        }\n        else if (this.direction == 'row') {\n            if (this.viewportNode.scrollLeft < 10) {\n                this.dataset.mosaicScrolledSide = 'left';\n            }\n            else if (this.viewportNode.scrollLeft > this.viewportNode.scrollWidth-this.viewportNode.clientWidth-10) {\n                this.dataset.mosaicScrolledSide = 'right';\n            } else {\n                this.dataset.mosaicScrolledSide = '';\n            }\n        }\n    }\n\n    protected onResize(msg: any): void {\n        // add width too?\n        const previousHeight = this.viewModel.height;\n        this.viewModel.height =\n            msg.height >= 0 ? msg.height : this.node.getBoundingClientRect().height;\n        if (this.viewModel.height !== previousHeight) {\n            void (this as any)._updater.invoke();\n        }\n        super.onResize(msg);\n        void (this as any)._updater.invoke();\n    }\n\n    protected onItemResize(entries: ResizeObserverEntry[]) { // @jupyterlab/ui-components/windowedlist.ts:1497\n        (this as any)._resetScrollToItem();\n\n        if (this.isHidden || this.isParentHidden) {\n            return;\n        }\n\n        for (const dim of ['row', 'col']) {\n            const newSizes: { index: number; size: number }[] = [];\n            for (let entry of entries) {\n                const size = (dim == 'row' ? \n                            entry.borderBoxSize[0].inlineSize : \n                            entry.borderBoxSize[0].blockSize\n                        );\n                // Update size only if item is attached to the DOM\n                if (entry.target.isConnected && size > 0) {\n                    // Rely on the data attribute as some nodes may be hidden instead of detach\n                    // to preserve state.\n                    newSizes.push({\n                        index: parseInt(\n                            (entry.target as HTMLElement).dataset.windowedListIndex!,\n                            10\n                        ),\n                        size: size\n                    });\n                }\n            }\n\n            // If some sizes changed\n            if (this.viewModel.setWidgetSize(newSizes, dim as FlexDirection)) {\n                (this as any)._scrollBackToItemOnResize();\n                // Update the list\n                this.update();\n            }\n            requestAnimationFrame(() => this.update());\n        }\n    }\n\n\n    get innerElement(): HTMLElement {\n        return (this as any)._innerElement;\n    }\n    updateTotalSize(): void {\n        if (this.viewModel.windowingActive) {\n            if (this.viewportNode.dataset.isScrolling == 'true') {\n                // Do not update while scrolling, delay until later\n                (this as any)._requiresTotalSizeUpdate = true;\n                return;\n            }\n            let estimatedTotalHeight = this.viewModel.getEstimatedTotalHeight();\n            if (this.direction == 'row') {\n                estimatedTotalHeight += 2*Mosaic.CSS.rowPaddingTop;\n            }\n            // Update inner container height\n            this.innerElement.style.height = `${estimatedTotalHeight}px`;\n\n            // let estimatedTotalWidth = this.viewModel.getEstimatedTotalWidth();\n            // if (this.direction == 'col') {\n            //     estimatedTotalWidth += 2*Mosaic.CSS.colPaddingLeft;\n            // }\n            // this.innerElement.style.width = `${estimatedTotalWidth}px`\n\n            if (   (this.viewportNode.scrollWidth > this.viewportNode.clientWidth)\n                || (this.viewportNode.scrollHeight > this.viewportNode.clientHeight)\n            ) {\n                this.node.classList.add('mosaic-scrolling');\n                this.node.style.setProperty('--scroll-width', `${this.viewportNode.scrollWidth}px`);\n                this.node.style.setProperty('--scroll-height', `${this.viewportNode.scrollHeight}px`);\n            } else {\n                this.node.classList.remove('mosaic-scrolling');\n            }\n        }\n    }\n\n    getEstimatedTotalHeight(): number {\n        return this.viewModel.getEstimatedTotalHeight();\n    }\n    getEstimatedTotalWidth(): number {\n        return this.viewModel.getEstimatedTotalWidth();\n    }\n\n\n\n    renderCellOutputs(index: number): void { // @jupyterlab\n        // updated to deal with submosaics\n        const tile = this.viewModel.widgetRenderer(index) as Cell;\n        if (tile instanceof CodeCell && tile.isPlaceholder()) { const cell = tile as CodeCell;\n            cell.dataset.windowedListIndex = `${index}`;\n            this.layout.insertWidget(index, cell);\n            // if (this.notebook.notebookConfig.windowingMode === 'full') {\n                // We need to delay slightly the removal to let codemirror properly initialize\n                requestAnimationFrame(() => {\n                    this.layout.removeWidget(cell);\n                });\n            // }\n        } else if (tile instanceof Mosaic && (tile as Mosaic).isPlaceholder()) { const mosaic = tile as Mosaic;\n            for (let i = 0; i < mosaic.tiles.length; i++) {\n                mosaic.renderCellOutputs(i);\n            }\n        }\n    }\n\n\n    detachWidget() {}\n    \n}\n\n\nexport namespace Mosaic {\n    export function showMosaic(t:Tile): any { // debugging function reducing mosaic to nested list of cell prompts\n        if (t instanceof Mosaic || t instanceof MosaicNotebook) {\n            return (t.tiles as any)._array.map(Mosaic.showMosaic);\n        } else if (t instanceof Cell) {\n            return 'Cell:'+(t as any).prompt;\n        } else {\n            return t;\n        }\n    }\n    export function getPath(cell:Cell): Array<string> | undefined {\n        return cell.model!.getMetadata(Mosaic.METADATA_NAME) as Array<string>;\n    }\n    export function setPath(cell:Cell, path:Array<string>): void {\n        return cell.model!.setMetadata(Mosaic.METADATA_NAME, path);\n    }\n    export function setParent(tile:Tile, mosaic: Mosaic | null) {\n        // console.warn('set parent', tile instanceof Cell ? 'Cell:'+(tile as any).prompt : 'mosaic:'+tile.path, tile.superMosaic, tile.parent, mosaic);\n        if (tile.superMosaic && tile.superMosaic !== mosaic) {\n            tile.superMosaic.tiles.removeValue(tile);\n        }\n        tile.superMosaic = mosaic;\n        // tile.parent = mosaic; // important: need to check parentage before removing, in case it was just moved to another list.\n    }\n    export function divergeDepth(path1: Array<string>, path2: Array<string>): number {\n        for (let i = 0; i < path1.length; i++) {\n            if (path2.length <= i || path1[i] !== path2[i]) return i;\n        }\n        return path1.length;\n    }\n    export function newUGID() {\n        return \"mg-\"+crypto.randomUUID();\n    }\n    export interface IOptions extends Notebook.IOptions{\n        direction: FlexDirection;\n        notebook: Notebook;\n    }\n}\n","import { INotebookModel, Notebook, NotebookPanel  } from '@jupyterlab/notebook';\nimport { Cell } from '@jupyterlab/cells';\nimport { WindowedLayout } from '@jupyterlab/ui-components';\n// import { ArrayExt } from '@lumino/algorithm';\n// import { EditorServices } from\n\nimport { mosaicDrop, mosaicDragOver } from './mosaicdrag';\nimport { FlexDirection, LeafCell, Mosaic, ObservableTree, Tile } from './MosaicGroup';\nimport { MosaicViewModel } from './MosaicViewModel';\n\nexport namespace MosaicNotebookPanel {\n    export class ContentFactory extends NotebookPanel.ContentFactory {\n        createNotebook(options: Notebook.IOptions) {\n            const mosaic = new MosaicNotebook(options);\n            return mosaic;\n        }\n    }\n}\n\n\n\n\nexport class MosaicNotebook extends Notebook {\n\n    public superMosaic = null;\n    public path = [];\n    public tiles: ObservableTree<Tile>;\n    protected mosaics: Map<string, Mosaic>;\n    protected options: Mosaic.IOptions;\n    public notebook: Notebook = this;\n    public direction: FlexDirection = 'col';\n\n    constructor(options: Notebook.IOptions) {\n        super(options);\n        this.tiles = new ObservableTree();\n        this.mosaics = new Map<string, Mosaic>();\n        this.options = {...options, direction: 'col', notebook: this};\n        this.notebook = this; // adopted mosaic methods refer to notebook property\n\n\n        const mvm = new MosaicViewModel(this.tiles, 'col', {\n                overscanCount: options.notebookConfig?.overscanCount  ??\n                    Mosaic.defaultConfig.overscanCount,\n                windowingActive: true\n            });\n        Object.defineProperty(this.viewModel, 'widgetCount', {get: mvm._getWidgetCount.bind(mvm)});\n        this.viewModel.estimateWidgetSize = mvm._estimateWidgetSize.bind(mvm);\n        this.viewModel.widgetRenderer = mvm._widgetRenderer.bind(mvm);\n\n\n        (this as any)._evtDrop = (e:any) => mosaicDrop(this, e);\n        (this as any)._evtDragOver = (e:any) => mosaicDragOver(this, e);\n\n        (this as any)._updateForDeferMode = this._myupdateForDeferMode;\n\n        this.tiles.changed.connect(this.onTreeChanged, this);\n\n    }\n\n    addTile = Mosaic.prototype.addTile.bind(this);\n    growBranch = Mosaic.prototype.growBranch.bind(this);\n    splice = Mosaic.prototype.splice.bind(this);\n    // treeGet = Mosaic.prototype.treeGet.bind(this);\n    treeGetExisting = Mosaic.prototype.treeGetExisting.bind(this);\n    // getBranchIndex = Mosaic.prototype.getBranchIndex.bind(this);\n    getLeaf = Mosaic.prototype.getLeaf.bind(this);\n    findGroup = Mosaic.prototype.findGroup.bind(this);\n    // findStem = Mosaic.prototype.findStem.bind(this);\n    renderCellOutputs = Mosaic.prototype.renderCellOutputs.bind(this);\n    onTreeChanged(tree: ObservableTree<Tile>, change:any) {\n        Mosaic.prototype.onTreeChanged.bind(this)(tree, change);\n        // console.log(this.tiles, Mosaic.showMosaic(this as any));\n        requestAnimationFrame(() => this.update());\n    }\n    unwrap = ()=>{};\n    checkEmpty = ()=>{};\n\n    get model() {\n        return super.model;\n    }\n    set model(model: INotebookModel | null) {\n        super.model = model;\n        // viewModel List changes handled by mosaicgroup. Don't need observable list to trigger it\n        this.viewModel.itemsList = this.tiles;\n    }\n\n\n    protected onCellInserted(index: number, cell: Cell): void {\n        super.onCellInserted(index, cell);\n        this.mosaicInsert(index);\n    }\n    protected onCellRemoved(index: number, cell: Cell): void {\n        super.onCellRemoved(index, cell);\n\n        const [found, ] = this.getLeaf(index);\n        if (found !== null) {\n            const [stem, leaf] = found;\n            if (leaf == cell) {\n                stem.tiles.removeValue(leaf);\n            } else {\n                console.warn('failed to remove', index, cell);\n            }\n        }\n    }\n\n    private async _myupdateForDeferMode(cell: Cell, cellIdx: number): Promise<void> { // modified from @jupyterlab/notebook/widget.ts:966\n        // insert widget into corresponding submosaic layout, not necessarily main notebook layout anymore\n        const [stem, localIdx] = this.mosaicInsert(cellIdx);\n        cell.dataset.windowedListIndex = `${localIdx}`;\n        (stem.layout as WindowedLayout).insertWidget(localIdx, cell);\n        await cell.ready;\n    }\n\n\n    graft(cell: LeafCell, path: Array<string>, refCell: LeafCell, refPath: Array<string>, refDiverge: number, offset:number = 0): [Mosaic, number] {\n        /**\n         * 'graft' the cell onto the tree (nested list of mosaics) adjacent to one of its neighbors (refCell)\n         */\n\n        // traverse up to where the path to cell branches off\n        // let base: Mosaic = this.leafStems.get(refCell)! as Mosaic;\n        let base = refCell.superMosaic!;\n        let reference: Tile = refCell as LeafCell;\n        for (let i = refPath.length; i > refDiverge; i--) {\n            reference = base;\n            base = reference.superMosaic! as Mosaic;\n        }\n        let idx = base.tiles.indexOf(reference);\n        // console.log('ref', base, reference, idx);\n        if (idx < 0) {\n            console.error('referrence leaf/branch missing!');\n            base = this as any;\n            idx = this.tiles.length; // send it to the end\n        } else {\n        idx += offset;\n        }\n        // console.log('ref', reference, 'base', base, 'refpath', refPath, 'refDiv', refDiverge, 'path', path);\n\n        // graft it\n        if (refDiverge < path.length) {\n            // grow the cell's own branch and attach at referrence index\n            const stem = base.growBranch(path.slice(refDiverge), [idx]);\n            stem.splice(0, 0, cell);\n            // console.log('grafted', 'branch:'+stem.path, 'to', base.path, 'at', idx);\n            return [stem, idx];\n        } else {\n            // cell attaches directly to reference's branch\n            base.splice(idx, 0, cell);\n            // console.log('grafted', 'Cell:'+(cell as any).prompt, 'to', base.groupID, 'at', idx);\n            return [base, idx];\n        }\n\n\n    }\n    mosaicInsert(index: number): [Mosaic | MosaicNotebook, number] {\n        /**  \n         * Group the inserted cell with one of its neighbors, to assemble the heirarchy out of a linear array\n         * can be though of as self-assembly: cell of index 'index' tries to graft itself to the branch of one of its neighbors\n         * Call after super.onCellInserted, cell to insert should be in this.cellsArray at give index\n        */\n        const prevCell = this.cellsArray[index-1] as LeafCell;\n        const cell = this.cellsArray[index] as LeafCell;\n        const nextCell = this.cellsArray[index+1] as LeafCell;\n\n        // remove from current group\n        Mosaic.setParent(cell, null);\n        cell.parent = null;\n\n        let prevPath = prevCell?.superMosaic?.path || [];//Mosaic.getPath(prevCell)! : [];\n        let path = Mosaic.getPath(cell); // use saved MD path to get where it goes, not where it is\n        let nextPath = nextCell?.superMosaic?.path || [];//Mosaic.getPath(nextCell)! : [];\n\n        if (index === 0 && !nextCell) { // first cell added, grow its branch and add it.\n            const branch = this.growBranch(path || []);\n            // this.insertLeaf(branch, cell);\n            branch.splice(0, 0, cell);\n            return [branch, 0];\n        }\n\n        if (path === undefined) {\n            // missing mosaic position metadata, join the previous cell\n            if (prevCell) path = prevPath; //return this.graft(cell, prevPath, prevCell, prevPath, prevPath.length, +1);\n            else path = []; // return this.graft(cell, [], nextCell, nextPath, 0, 0);\n        }\n\n        // having handled the special cases, graft to whichever branches off current cell's path later\n\n        let prevDiverge = prevCell?.superMosaic ? Mosaic.divergeDepth(prevPath, path) : -1;\n        let nextDiverge = nextCell?.superMosaic ? Mosaic.divergeDepth(nextPath, path) : -1;\n\n        // if we've left the groups of the other cells, let them collapse if underpopulated\n        if (prevCell && prevCell.superMosaic) {\n            let prevGroup: any = prevCell;\n            for ( let i = prevDiverge; i < prevPath.length; i++ ) {\n                prevGroup = prevGroup!.superMosaic!;\n                prevGroup?.checkEmpty();\n            }\n            // path was updated by collapsing redundant groups\n            prevPath = prevCell.superMosaic!.path;\n            prevDiverge = prevCell.superMosaic ? Mosaic.divergeDepth(prevPath, path) : -1;\n        }\n        if (nextCell && nextCell.superMosaic) {\n            let nextGroup: any = nextCell;\n            for ( let i = nextDiverge; i < nextPath.length; i++ ) {\n                nextGroup = nextGroup!.superMosaic!;\n                nextGroup?.checkEmpty();\n            }\n            // path was updated by collapsing redundant groups\n            nextPath = nextCell.superMosaic.path;\n            nextDiverge = nextCell.superMosaic ? Mosaic.divergeDepth(nextPath, path) : -1;\n        }\n\n        // console.log('prev, next', prevPath, nextPath, prevDiverge, nextDiverge);\n        \n        if (prevDiverge < 0 && nextDiverge < 0) {\n            throw new Error('both neighbors unattached! unable to graft');\n        }\n        switch (Math.max(prevDiverge, nextDiverge)) { \n            case (prevDiverge): {\n                return this.graft(cell, path, prevCell, prevPath, prevDiverge, +1)\n            }\n            case (nextDiverge): {\n                return this.graft(cell, path, nextCell, nextPath, nextDiverge, 0);\n            }\n            default: {\n                throw new Error('invalid path divergence!');\n            }\n        }\n    }\n}\n","import { NotebookViewModel } from '@jupyterlab/notebook';\nimport { Cell, CodeCellModel } from '@jupyterlab/cells';\nimport { WindowedList } from '@jupyterlab/ui-components'\nimport { Widget } from '@lumino/widgets';\n\nimport type { FlexDirection, ObservableTree, Tile } from './MosaicGroup';\n\n\n\n\nexport class MosaicViewModel extends NotebookViewModel {//WindowedListModel {\n    static CELL_MIN_WIDTH = 160;\n    // protected cellsEstimatedHeight = new Map<string, number>();\n    protected tilesEstimatedWidth = new Map<string, number>();\n    protected tilesEstimatedHeight = new Map<string, number>();\n    protected _widgetSizersRow: WindowedList.ItemMetadata[] = [];\n    protected _widgetSizersCol: WindowedList.ItemMetadata[] = [];\n\n    // protected _modelList: NestedObservableList<ICellModel>;\n    // private _emitEstimatedSizeChanged = new Debouncer(() => {\n    // this._stateChanged.emit({\n    //     name: 'estimatedWidgetSize',\n    //     newValue: null,\n    //     oldValue: null\n    //     });\n    // });\n    // protected cells: Array<Tile>;\n    protected _tiles: ObservableTree<Tile> | null = null;\n    constructor(\n        tiles: ObservableTree<Tile>,\n        public direction: FlexDirection,\n        options?: WindowedList.IModelOptions\n    ) {\n        super([], options);\n        this.tiles = tiles;\n\n        // overload private properties\n        Object.defineProperty(this, '_widgetSizers', {\n            get() {\n                // console.warn('default widg sizer requested');\n                if (this.direction == 'row') return this._widgetSizersRow;\n                if (this.direction == 'col') return this._widgetSizersCol;\n            }\n        });\n        (this as any)._getItemMetadata = this.getItemMetadata;\n    }\n\n    set tiles(ts:ObservableTree<Tile>) {\n        this._tiles = ts;\n        this.itemsList = ts;\n    }\n    get tiles(): ObservableTree<Tile> | null {\n        return this._tiles;\n    }\n\n    public onListChanged(list: any, changes: any): void {\n        return super.onListChanged(list, changes);\n    }\n\n    _getWidgetCount(): number {\n        return this.tiles?.length || 0;\n    }\n    get widgetCount() {\n        return this._getWidgetCount();\n    }\n\n    _widgetRenderer (index: number): Widget {\n        return (this.tiles!.get(index))\n    }\n    // widgetRenderer is defined as a property rather than a method on super, so must follow suit\n    widgetRenderer: (index: number) => Widget = MosaicViewModel.prototype._widgetRenderer.bind(this);//(index: number) => MosaicViewModel._widgetRenderer(this, index); // work around for \"Class 'WindowedListModel' defines instance member property 'widgetRenderer', but extended class 'MosaicViewModel' defines it as instance member function.\"\n\n    // get widgetSizers() {\n    //     return (this as any)._widgetSizers;\n    // }\n    setWidgetSize(sizes: { index: number; size: number; }[], dim: 'row' | 'col' | 'mode' = 'mode'): boolean {\n        if (dim == 'mode') dim = this.direction;\n\n        // just use the same code as super, but with a different widgetSizers list based on dim\n        return super.setWidgetSize.bind(new Proxy(this, {\n            get(target, p, receiver) {\n                if (p == '_widgetSizers') return (dim == 'row' ? target._widgetSizersRow : target._widgetSizersCol)\n                \n                return Reflect.get(target, p, receiver);\n            },\n        }))(sizes);\n    }\n    estimateWidgetSize: (index: number) => number = MosaicViewModel.prototype._estimateWidgetSize.bind(this);\n    _estimateWidgetSize (index: number): number {\n\n        // this.parent.index\n        const tile = this.tiles?.get(index);\n        if (!tile) {\n            // This should not happen, but if it does,\n            // do not throw if tile was deleted in the meantime\n            console.warn(\n                `estimateWidgetSize requested for item ${index} in mosaic with only ${this.widgetCount} items`\n            );\n            return 0;\n        }\n\n        if (this.direction == 'row') {\n            return this.estimateWidgetWidth(index);\n        } else { // column mode, want height rather than width\n            return this.estimateWidgetHeight(index);\n        }\n    }\n    estimateWidgetHeight(index:number): number {\n        const tile = this.tiles!.get(index);\n        if (tile instanceof Cell) {\n            // return NotebookViewModel.prototype.estimateWidgetSize.bind({\n            //         cells: {[index]: tile},\n            //         cellsEstimateSize: this.tilesEstimatedHeight}\n            //     )(index);\n            // original jupyterlab NotebookViewModel height estimation\n            const model = tile.model;\n            const height = this.tilesEstimatedHeight.get(model.id);\n            // const height = 39;\n            if (typeof height === 'number') {\n            //     // console.log('tile height', id, height);\n                return height;\n            }\n\n            const nLines = model.sharedModel.getSource().split('\\n').length;\n            let outputsLines = 0;\n            if (model instanceof CodeCellModel && !model.isDisposed) {\n                for (let outputIdx = 0; outputIdx < model.outputs.length; outputIdx++) {\n                    const output = model.outputs.get(outputIdx);\n                    const data = output.data['text/plain'];\n                    if (typeof data === 'string') {\n                        outputsLines += data.split('\\n').length;\n                    } else if (Array.isArray(data)) {\n                        outputsLines += data.join('').split('\\n').length;\n                    }\n                }\n            }\n            return (\n                NotebookViewModel.DEFAULT_EDITOR_LINE_HEIGHT * (nLines + outputsLines) +\n                NotebookViewModel.DEFAULT_CELL_MARGIN\n            );\n        } else { // sub mosaic\n            const height = this.tilesEstimatedHeight.get(tile.groupID);\n            // console.log('mosaic est height', height);\n            if (typeof height === 'number') {\n                return height;\n            }\n\n            // console.log('est total', tile.getEstimatedTotalHeight());\n            return tile.getEstimatedTotalHeight();\n        }\n    }\n    estimateWidgetWidth(index:number): number {\n        const tile = this.tiles!.get(index);\n        if (tile instanceof Cell) {\n            return MosaicViewModel.CELL_MIN_WIDTH;\n        } else {\n            const width = this.tilesEstimatedWidth.get(tile.groupID);\n            if (typeof width == 'number') {\n                return width;\n            }\n\n            return tile.getEstimatedTotalWidth();\n        }\n    }\n\n    set measuredAllUntilIndex(val: number) {\n        (this as any)._measuredAllUntilIndex = val;\n    }\n\n    getEstimatedTotalSize(dim: 'row' | 'col' | 'mode' = 'mode'): number { // based on @jupyterlab/ui-components/windowedlist.ts:279\n        if (dim == 'mode') dim = this.direction;\n        const widgetSizers = (dim == 'row' ? this._widgetSizersRow : this._widgetSizersCol);\n\n        let totalSizeOfInitialItems = 0;\n\n        if (this.measuredAllUntilIndex >= this.widgetCount) {\n            this.measuredAllUntilIndex = this.widgetCount - 1;\n        }\n\n        // These items are all measured already\n        if (this.measuredAllUntilIndex >= 0) {\n            const itemMetadata = widgetSizers[this.measuredAllUntilIndex];\n            totalSizeOfInitialItems = itemMetadata.offset + itemMetadata.size;\n        }\n\n        // These items might have measurements, but some will be missing\n        let totalSizeOfRemainingItems = 0;\n        for (let i = this.measuredAllUntilIndex + 1; i < this.widgetCount; i++) {\n            const sizer = widgetSizers[i];\n            totalSizeOfRemainingItems += sizer?.measured\n                ? sizer.size\n                : this.estimateWidgetSize(i);\n        }\n\n        return totalSizeOfInitialItems + totalSizeOfRemainingItems;\n    }\n    getEstimatedTotalHeight(): number {\n        if (this.direction == 'col') {\n            return this.getEstimatedTotalSize('col');\n        }\n        // total height of a row is really max height of elements\n        let maxSize = 0;\n        for (let i = 0; i < this.widgetCount; i++) {\n            const sizer = this._widgetSizersCol[i];\n            // console.log('row el height', sizer, this.estimateWidgetHeight(i), this.widgetRenderer(i));\n            maxSize = Math.max(maxSize, sizer?.measured\n                ? sizer.size\n                : this.estimateWidgetHeight(i));\n        }\n\n        return maxSize;\n    }\n    getEstimatedTotalWidth(): number {\n        if (this.direction == 'row') {\n            return this.getEstimatedTotalSize('row');\n        }\n        \n        // total width of a column is really max width of elements\n        let maxSize = 0;\n        for (let i = 0; i < this.widgetCount; i++) {\n            const sizer = this._widgetSizersRow[i]; // row for width measurments\n            maxSize = Math.max(maxSize, sizer?.measured\n                ? sizer.size\n                : this.estimateWidgetWidth(i));\n        }\n\n        return maxSize;\n    }\n    \n\n    get measuredAllUntilIndex(): number {\n        // let me use their private field\n        return -1;//(this as any)._measuredAllUntilIndex as number;\n    }\n\n    \n    private getItemMetadata(index: number): WindowedList.ItemMetadata {\n\n        for (const mode of ['row', 'col']) {\n            const widgetSizers = {'row': this._widgetSizersRow, 'col':this._widgetSizersCol}[mode]!;\n            \n            if (index > this.measuredAllUntilIndex) {\n                let offset = 0;\n                if (this.measuredAllUntilIndex >= 0) {\n                    const itemMetadata = widgetSizers[this.measuredAllUntilIndex];\n                    offset = itemMetadata.offset + itemMetadata.size;\n                }\n\n                for (let i = this.measuredAllUntilIndex + 1; i <= index; i++) {\n                    let size: number;\n                    let measured = false;\n\n                    if (widgetSizers[i]?.measured) {\n                        size = widgetSizers[i].size;\n                        measured = true;\n                    } else {\n                        const widget = this.widgetRenderer(i);\n                        if (widget?.node && widget.node.isConnected && widget.node.style.display != 'none') {\n                            const rect = widget.node.getBoundingClientRect();\n                            size = (mode == 'row' ? rect.width : rect.height);\n                            measured = true;\n                        } else {\n                            size = (mode == 'row' ? \n                                            this.estimateWidgetWidth(i)\n                                        :   this.estimateWidgetHeight(i));\n                            measured = false;\n                        }\n                    }\n\n                    widgetSizers[i] = { offset, size, measured };\n                    offset += size;\n                }\n                // Because the loop above updates estimated sizes,\n                // we need to fix (heal) offsets of the remaining items.\n                for (let i = index + 1; i < widgetSizers.length; i++) {\n                    const sizer = widgetSizers[i];\n                    const previous = widgetSizers[i - 1];\n                    sizer.offset = previous.offset + previous.size;\n                }\n            }\n            \n\n            for (let i = 0; i <= this.measuredAllUntilIndex; i++) {\n                const sizer = widgetSizers[i];\n                if (i === 0) {\n                    if (sizer.offset !== 0) {\n                        throw new Error('First offset is not null');\n                    }\n                } else {\n                    const previous = widgetSizers[i - 1];\n                    if (sizer.offset !== previous.offset + previous.size) {\n                        throw new Error(`Sizer ${i} has incorrect offset.`);\n                    }\n                }\n            }\n        }\n\n        return this.direction == 'row' ? this._widgetSizersRow[index] : this._widgetSizersCol[index];\n    }\n\n    getRangeToRender(): WindowedList.WindowIndex | null {\n        // const r2r = super.getRangeToRender();\n        // console.log(\"R2R\", r2r);\n\n        const wc = this.widgetCount;\n        // console.log('artificial', wc-1);\n        return [0, wc-1, 0, wc-1]//r2r;\n    }\n\n}","import {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin,\n} from '@jupyterlab/application';\n\nimport { IEditorServices } from '@jupyterlab/codeeditor';\nimport { NotebookWidgetFactory, NotebookTracker, INotebookTracker, INotebookModel } from '@jupyterlab/notebook' \nimport { NotebookPanel, NotebookModelFactory } from '@jupyterlab/notebook';\nimport { DocumentRegistry } from '@jupyterlab/docregistry';\nimport { IDocumentManager } from '@jupyterlab/docmanager';\nimport { ILauncher } from '@jupyterlab/launcher';\nimport { LabIcon } from '@jupyterlab/ui-components';\nimport { ILayoutRestorer } from '@jupyterlab/application';\n\nimport { MosaicNotebookPanel, MosaicNotebook } from './MosaicNotebookPanel';\n\nimport MosaicIcon from '../style/icons/mosaic-icon.svg';\n\nimport { DocumentManager } from '@jupyterlab/docmanager';\n/** patch DocumnetManager to not open default editor when no widgetName is specified if a different editor exists\n  * added to jupyterlab in PR https://github.com/jupyterlab/jupyterlab/pull/18034\n  * important for not duplicating Mosaic and Jupyter Notebook editors when reloading (restoring workspace) */\nDocumentManager.prototype.openOrReveal = function (path:string, widgetName:any = null, kernel?: any, options?: any) {\n  const widget = this.findWidget(path, widgetName);\n  if (widget) {\n    (this as any)._opener.open(widget, {\n      type: widgetName || 'default',\n      ...options\n    });\n    return widget;\n  }\n  return this.open(path, widgetName || 'default', kernel, options ?? {});\n};\n///// end patch\n\n\nconst MosaicLabIcon = new LabIcon({ name: 'mosaic:favicon', svgstr: MosaicIcon.toString()});\n\nconst PLUGIN_ID = 'mosaic-lab:plugin';\nconst MOSAIC_FACTORY = 'MosaicNotebook';\n\n\nclass MosaicModelFactory extends NotebookModelFactory {\n  get name(): string {\n    return 'mosaic-notebook';\n  }\n}\n\n/**\n * Initialization data for the mosaic-lab extension.\n */\nconst plugin: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID,\n  description: 'Arrange Jupyter notebook cells in any way two-dimensionally. Present your code compactly in Zoom video confrences. Let your Jupyter notebook tell the story and be self-documenting in itself, like a poster presentation. Eliminate white space in your notebook and take advantage of unused screen real estate.',\n  autoStart: true,\n  requires: [INotebookTracker, ILauncher, IEditorServices, ILayoutRestorer, IDocumentManager],\n  optional: [],\n  activate: async (app: JupyterFrontEnd, tracker: NotebookTracker,  launcher: ILauncher, editorServices: IEditorServices,\n                  restorer: ILayoutRestorer, docmanager: DocumentManager) => {\n    console.log('JupyterLab extension mosaic-lab is activated!');\n    \n\n    ////// Patch the tracker to allow two different kinds of widgets, open simultaneously and restored correctly\n    ////// This is easier than creating a new NotebookTracker() and having to reattach all the command enabling hooks to the new namespace\n    const getNotebookFactoryName = (panel: NotebookPanel) => (panel.content instanceof MosaicNotebook ? MOSAIC_FACTORY : 'Notebook');\n    (tracker as any)._pool._restore.args = (widget: NotebookPanel) => ({\n                path: widget.context.path,\n                factory: getNotebookFactoryName(widget),\n            });\n    (tracker as any)._pool._restore.name = (widget: NotebookPanel) => `${widget.context.path}:${getNotebookFactoryName(widget)}`;\n    /////// end patching tracker\n\n    // const tracker = new NotebookTracker({\n    //   namespace: 'mosaic-notebook'\n    // });\n\n    // restorer.restore(tracker, {\n    //   command: 'docmanager:open',\n    //   args: widget => ({\n    //     path: widget.context.path,\n    //     factory: MOSAIC_FACTORY\n    //   }),\n    //   name: widget => `${widget.context.path}:${MOSAIC_FACTORY}`,\n    // });\n\n    app.serviceManager.workspaces.list().then(value => {\n      console.log(\"WORKSPACES\", value);\n    });\n    // app.serviceManager.workspaces.fetch('defaul').then((workspace:any) => {\n    //   console.log('WORKSPACE', workspace);\n    // });\n    \n    // re-use existing context to open a file as both Mosaic and Jupyter notebook, so they stay in sync\n    const createContext = (docmanager as any)._createContext.bind(docmanager);\n    (docmanager as any)._createContext = (path: string, factory: any, ...args:any[]) => {\n      // find existing panel editing this file\n      const other = tracker.find((otherPanel: NotebookPanel) => (otherPanel.context.path == path));\n\n      if (other !== undefined) {\n        return other.context;\n      }\n      return createContext(path, factory);\n    }\n    \n\n    const jupyterWidgetFactory = app.docRegistry.getWidgetFactory('Notebook') as any as NotebookWidgetFactory;\n\n    const mosaicModelFactory = new MosaicModelFactory({ disableDocumentWideUndoRedo: false });\n    app.docRegistry.addModelFactory(mosaicModelFactory);\n\n    const mosaicWidgetFactory = (new NotebookWidgetFactory({\n      name: MOSAIC_FACTORY,\n      fileTypes: ['notebook'],\n      defaultFor: ['notebook'],\n      modelName: 'mosaic-notebook',\n      preferKernel: true,\n      canStartKernel: true,\n      rendermime: jupyterWidgetFactory.rendermime,\n      contentFactory: new MosaicNotebookPanel.ContentFactory({\n          editorFactory: editorServices.factoryService.newInlineEditor\n        }),\n      mimeTypeService: jupyterWidgetFactory.mimeTypeService,\n      toolbarFactory: (jupyterWidgetFactory as any)._toolbarFactory,\n      // notebookConfig: {}\n    }));\n    mosaicWidgetFactory.widgetCreated.connect((sender: DocumentRegistry.IWidgetFactory<NotebookPanel, INotebookModel>, panel: NotebookPanel) => {\n      tracker.add(panel);\n      panel.title.icon = MosaicLabIcon;\n    });\n\n    app.docRegistry.addWidgetFactory(mosaicWidgetFactory as any);\n    app.docRegistry.setDefaultWidgetFactory('notebook', MOSAIC_FACTORY);\n\n\n    // give Mosaic Notebook all the bells and whistles of a normal notebook (cell action buttons)\n    for (const ext of app.docRegistry.widgetExtensions('Notebook')) {\n      app.docRegistry.addWidgetExtension(MOSAIC_FACTORY, ext);\n    }\n\n    // create launch command\n    app.commands.addCommand('mosaic-notebook:create-new', {\n      label: args => `Mosaic ${app.serviceManager.kernelspecs.specs?.kernelspecs[args.kernelName as string]?.display_name || ''}`,\n      caption: 'Create a new Mosaic Notebook',\n      execute: async ({ kernelName }) => {\n        const model = await app.commands.execute('docmanager:new-untitled', {\n          type: 'notebook'\n        });\n\n        return app.commands.execute('docmanager:open', {\n          path: model.path,\n          factory: MOSAIC_FACTORY,\n          kernel: {name: kernelName}\n        });\n      },\n      icon: MosaicLabIcon,\n      iconLabel: 'Mosaic Notebook'\n    });\n    \n    // add launch icon to launcher\n    for (const name in app.serviceManager.kernelspecs.specs!.kernelspecs) {\n      const spec = app.serviceManager.kernelspecs.specs!.kernelspecs[name];\n      launcher.add({\n        command: 'mosaic-notebook:create-new',\n        args: { kernelName: name },\n        category: 'Notebook',\n        rank: 0,\n        kernelIconUrl: `${spec!.resources['logo-svg']}`,\n      });\n    }\n\n  }\n};\n\nexport default plugin;\n","import { NotebookActions } from '@jupyterlab/notebook';\n// import { DROP_TARGET_CLASS } from '@jupyterlab/notebook/src/constants'\nimport { Drag } from '@lumino/dragdrop'\nimport { Cell, MarkdownCell } from '@jupyterlab/cells'\nimport { ArrayExt, findIndex } from '@lumino/algorithm'\nimport { Mosaic } from './MosaicGroup';\nimport { MosaicNotebook } from './MosaicNotebookPanel';\n\n// import { MosaicNotebookViewModel } from './MosaicViewModel';\nconst DROP_TARGET_CLASS = 'jp-mod-dropTarget';\nconst JUPYTER_CELL_CLASS = 'jp-Cell';\nconst JUPYTER_CELL_MIME = 'application/vnd.jupyter.cells';\n\nexport function mosaicDrop(self: MosaicNotebook, event: Drag.Event) {\n    if (!event.mimeData.hasData(JUPYTER_CELL_MIME)) {\n      return;\n    }\n    event.preventDefault();\n    event.stopPropagation();\n    if (event.proposedAction === 'none') {\n      event.dropAction = 'none';\n      return;\n    }\n\n    let target = event.target as HTMLElement;\n    while (target && target.parentElement) {\n      if (target.classList.contains(DROP_TARGET_CLASS)) {\n        target.classList.remove(DROP_TARGET_CLASS);\n        break;\n      }\n      target = target.parentElement;\n    }\n\n    // Model presence should be checked before calling event handlers\n    self.model!;\n\n    const source: MosaicNotebook = event.source;\n    if (source === self) {\n      // Handle the case where we are moving cells within\n      // the same notebook.\n      event.dropAction = 'move';\n      const toMove: Cell[] = event.mimeData.getData('internal:cells');\n\n      // For collapsed markdown headings with hidden \"child\" cells, move all\n      // child cells as well as the markdown heading.\n      const cell = toMove[toMove.length - 1];\n      if (cell instanceof MarkdownCell && cell.headingCollapsed) {\n        const nextParent = NotebookActions.findNextParentHeading(cell, source);\n        if (nextParent > 0) {\n          const index = findIndex(source.widgets, (possibleCell: Cell) => {\n            return cell.model.id === possibleCell.model.id;\n          });\n          toMove.push(...source.widgets.slice(index + 1, nextParent));\n        }\n      }\n\n      // Compute the to/from indices for the move.\n      let fromIndex = ArrayExt.firstIndexOf(self.widgets, toMove[0]);\n      let toIndex = (self as any)._findCell(target);\n\n\n      /** < MODIFIED: MOSAIC > **/\n      let mosaicPath: string[] = [];\n      let targetCell: Cell;\n      if (toIndex < 0) { // not dropped on a cell, likely on mosaicgroup border\n         while (target && target.parentElement) { // get nearest group\n          if (target.classList.contains(Mosaic.NODE_CLASS)) {\n            target.classList.remove(DROP_TARGET_CLASS);\n            break;\n            // mosaicPath = self.findGroup(target);\n            // if (mosaicPath !== null) break;\n          }\n          target = target.parentElement;\n        }\n        if (!target || !target.parentElement) { // found no group. dropping at end of notebook\n          toIndex = -1;\n          target = self.viewportNode;\n          source.viewportNode.classList.remove(DROP_TARGET_CLASS);\n        }\n      }\n\n      const side = target.dataset.mosaicDropSide || closestSide(event, target);\n      const collike = (side == 'bottom' || side == 'top');\n      const rowlike = (side == 'left' || side == 'right');\n      const beforelike = side == 'top' || side == 'left';\n      const afterlike = side == 'bottom' || side == 'right';\n\n      if (toIndex < 0) { // on group or end space, not cell\n        if (target.classList.contains(Mosaic.NODE_CLASS)) { // selecting edge of group\n          const cells = target.getElementsByClassName(JUPYTER_CELL_CLASS);\n          toIndex = (self as any)._findCell(cells[beforelike ? 0 : cells.length-1]) // get first or last cell, if going before or after\n          if (toIndex < 0) return;\n          targetCell = self.widgets[toIndex];\n          mosaicPath = Mosaic.getPath(targetCell)!;\n          // dropping on a group, we want to be beside it not inside, so back out 1 from the contained cell's path\n          if (mosaicPath.length > 0) mosaicPath = mosaicPath.slice(0, mosaicPath.length-1)\n        } else {\n          targetCell = self.widgets[self.widgets.length-1];\n        }\n      } else { // found a cell to drop on\n        targetCell = self.widgets[toIndex];\n        mosaicPath = Mosaic.getPath(targetCell) || [];\n      }\n\n      \n      // create a new group to subdivide depending on side of cells its dropped on\n      // const [targetGroup, ] = self.treeGetExisting(mosaicPath); // group to insert things in\n      const targetAxis = (mosaicPath.length % 2) === 0 ? 'col' : 'row';\n      if ( (targetAxis == 'row' && collike)\n        || (targetAxis == 'col' && rowlike)) {\n            // dropping off-axis (on top/bottom for row, or left/right for col)\n            // means we subdivide. Create a new group:\n            mosaicPath = [...mosaicPath, Mosaic.newUGID()];\n            targetCell.model.setMetadata(Mosaic.METADATA_NAME, mosaicPath); // destination cell is part of this new group\n      }\n\n      // get the deepest common branch of all cells to move\n      let divergeDepth = 0;\n      let sharedPath = Mosaic.getPath(toMove[0]) || [];\n      for (let movecell of toMove) {\n        const path = Mosaic.getPath(movecell)!;\n        divergeDepth = Mosaic.divergeDepth(path, sharedPath);\n        sharedPath = path.slice(0, divergeDepth);\n      }\n\n      // grafting multiple cells may transpose rows and columns. give an extra wraper to preserve source structure\n      let transposeGroup;\n      // mod 2 of the path tells us whether its a row or column, since these must alternate\n      if (toMove.length > 1 && (divergeDepth % 2) !== (mosaicPath.length % 2)) {\n        transposeGroup = Mosaic.newUGID();\n      }\n\n      // assign the metadata to each cell to place it in the mosaic\n      for (const movecell of toMove) {\n        const prevpath = Mosaic.getPath(movecell)!;\n        if (transposeGroup) prevpath.splice(divergeDepth, 0, transposeGroup);\n        // graft moved cell onto tree, preserving any internal structure \n        Mosaic.setPath(movecell, [...mosaicPath, ...prevpath.slice(divergeDepth)]);\n      }\n\n      if (toIndex === -1) {\n        // If the drop is within the notebook but not on any cell,\n        // most often self means it is past the cell areas, so\n        // set it to move the cells to the end of the notebook.\n        toIndex = self.widgets.length - 1;\n      }\n\n      let firstChangedIndex = toIndex; // include destination cell in those rearranged by mosaic, even if unmoved in index\n\n      if (afterlike) {\n        toIndex += 1; // drop on bottom or right of cell to go after it\n      }\n\n      // self check is needed for consistency with the view.\n      if (toIndex !== self.widgets.length - 1 && toIndex !== -1 && toIndex > fromIndex) {\n        toIndex -= 1;\n      } \n      // Don't move if we are within the block of selected cells.\n      if (toIndex >= fromIndex && toIndex < fromIndex + toMove.length) {\n        firstChangedIndex = Math.min(fromIndex, firstChangedIndex);\n        console.log('first changed cell', (self.widgets[firstChangedIndex] as any).prompt)\n        for (let i = 0; i < toMove.length+1; i++) {\n          console.log('mos insert', 'Cell:'+ (self.widgets[firstChangedIndex+i] as any).prompt);\n          self.mosaicInsert(firstChangedIndex+i);\n          // self.mosaicInsert(movedcell); // TODO - make before/after, with/new integrate within Notebook/model?\n        }\n        return;\n      }\n\n      // Move the cells one by one\n      self.moveCell(fromIndex, toIndex, toMove.length);\n\n      // moveCell usually triggers onCellInserted which does the mosaicInsertion itself,\n      // except for when creating a new group without reordering the cells, so we do it manually here\n      // cells taken out from before the destination just shift the destination back.\n      // orig jupyter code subtracted 1 already if toIndex > fromIndex, so we add 1\n      if (toIndex > fromIndex) firstChangedIndex -= toMove.length; \n      // if (afterlike) firstChangedIndex -= 1; // include target cell even if dropped after it\n      console.log('first changed cell', (self.widgets[firstChangedIndex] as any).prompt)\n      for (let i = 0; i < toMove.length+1; i++) { // go for toMove.length+1 : do the moved cells and target cell\n        console.log('mos insert', 'Cell:'+(self.widgets[firstChangedIndex+i] as any).prompt);\n        self.mosaicInsert(firstChangedIndex+i);\n      }\n\n    } else {\n      // CROSS NOTEBOOK MOSAIC NOT YET IMPLEMENTED\n    }\n}\n\n\n\nexport function mosaicDragOver(self: MosaicNotebook, event: Drag.Event): void {\n  if (!event.mimeData.hasData(JUPYTER_CELL_MIME)) {\n    return;\n  }\n  event.preventDefault();\n  event.stopPropagation();\n  event.dropAction = event.proposedAction;\n  const elements = self.node.getElementsByClassName(DROP_TARGET_CLASS);\n  if (elements.length) {\n    (elements[0] as HTMLElement).classList.remove(DROP_TARGET_CLASS);\n  }\n  let target = event.target as HTMLElement;\n  while (target && target.parentElement) {\n    if (target.classList.contains(JUPYTER_CELL_CLASS)) {\n      break;\n    }\n    target = target.parentElement;\n  }\n\n  let index = (self as any)._findCell(target);\n\n  const side = closestSide(event, target);\n  // const collike = (side == 'bottom' || side == 'top');\n  // const rowlike = (side == 'left' || side == 'right');\n  // const beforelike = side == 'top' || side == 'left';\n  // const afterlike = side == 'bottom' || side == 'right';\n  if (index === -1) { // likely on a group border rather than a cell\n    // let path = null; // try to find the group\n    while (target && target.parentElement) {\n      if (target.classList.contains(Mosaic.NODE_CLASS)) {\n        target.classList.add(DROP_TARGET_CLASS);\n        target.dataset.mosaicDropSide = side;\n        break;\n        // path = self.findGroup(target);\n        // if (path !== null) break;\n      }\n      target = target.parentElement;\n    }\n\n    if (!target || !target.parentElement) { // nothing found, probably dropping off end of notebook.\n      event.source.viewportNode.classList.add(DROP_TARGET_CLASS);\n      event.source.viewportNode.dataset.mosaicDropSide = 'bottom';\n    }\n  } else {\n    const widget = (self as any).cellsArray[index];\n    widget.node.classList.add(DROP_TARGET_CLASS);\n\n    // mosaic: show line on side its going to insert on\n    widget.node.dataset.mosaicDropSide = side;\n  }\n\n\n}\n\n\n\n\n\n/**\n * Calculate which side of the target element the mouse is closest to. [BY: CHATGPT]\n * @param e The drag event from @lumino/dragdrop\n * @param target The target HTMLElement\n * @returns One of 'top', 'left', 'bottom', 'right'\n */\nfunction closestSide(e: Drag.Event, target: HTMLElement): 'top' | 'left' | 'bottom' | 'right' {\n  const rect = target.getBoundingClientRect();\n  const x = e.clientX;\n  const y = e.clientY;\n\n  // Calculate distances to each side\n  const distTop = Math.abs(y - rect.top);\n  const distLeft = Math.abs(x - rect.left);\n  const distBottom = Math.abs(y - rect.bottom);\n  const distRight = Math.abs(x - rect.right);\n\n  // Find the minimum distance\n  const minDist = Math.min(distTop, distLeft, distBottom, distRight);\n\n  switch (minDist) {\n    case distTop:\n      return 'top';\n    case distLeft:\n      return 'left';\n    case distBottom:\n      return 'bottom';\n    case distRight:\n      return 'right';\n    default:\n      // Fallback, shouldn't happen\n      return 'top';\n  }\n}"],"names":[],"sourceRoot":""}