"use strict";(self.webpackChunkmosaic=self.webpackChunkmosaic||[]).push([[475],{475:(e,t,i)=>{i.r(t),i.d(t,{default:()=>x});var o=i(291),s=i(762),n=i(138),r=i(775),l=i(694),a=i(669),d=i(560),c=i(329),h=i(53),u=i(262),p=i(463);class g extends s.NotebookViewModel{constructor(e,t,i){super([],i),this.direction=t,this.tilesEstimatedWidth=new Map,this.tilesEstimatedHeight=new Map,this._widgetSizersRow=[],this._widgetSizersCol=[],this._tiles=null,this.widgetRenderer=g.prototype._widgetRenderer.bind(this),this.estimateWidgetSize=g.prototype._estimateWidgetSize.bind(this),this.tiles=e,Object.defineProperty(this,"_widgetSizers",{get(){return"row"==this.direction?this._widgetSizersRow:"col"==this.direction?this._widgetSizersCol:void 0},set(e){"row"==this.direction&&(this._widgetSizersRow=e),"col"==this.direction&&(this._widgetSizersCol=e)}}),this._getItemMetadata=this.getItemMetadata}set tiles(e){this._tiles=e,this.itemsList=e}get tiles(){return this._tiles}onListChanged(e,t){return super.onListChanged(e,t)}_getWidgetCount(){var e;return(null===(e=this.tiles)||void 0===e?void 0:e.length)||0}get widgetCount(){return this._getWidgetCount()}_widgetRenderer(e){return this.tiles.get(e)}setWidgetSize(e,t="mode"){return"mode"==t&&(t=this.direction),super.setWidgetSize.bind(new Proxy(this,{get:(e,i,o)=>"_widgetSizers"==i?"row"==t?e._widgetSizersRow:e._widgetSizersCol:Reflect.get(e,i,o)}))(e)}_estimateWidgetSize(e){var t;return(null===(t=this.tiles)||void 0===t?void 0:t.get(e))?"row"==this.direction?this.estimateWidgetWidth(e):this.estimateWidgetHeight(e):(console.warn(`estimateWidgetSize requested for item ${e} in mosaic with only ${this.widgetCount} items`),0)}estimateWidgetHeight(e){const t=this.tiles.get(e);if(t instanceof c.Cell){const e=t.model,i=this.tilesEstimatedHeight.get(e.id);if("number"==typeof i)return i;const o=e.sharedModel.getSource().split("\n").length;let n=0;if(e instanceof c.CodeCellModel&&!e.isDisposed)for(let t=0;t<e.outputs.length;t++){const i=e.outputs.get(t).data["text/plain"];"string"==typeof i?n+=i.split("\n").length:Array.isArray(i)&&(n+=i.join("").split("\n").length)}return s.NotebookViewModel.DEFAULT_EDITOR_LINE_HEIGHT*(o+n)+s.NotebookViewModel.DEFAULT_CELL_MARGIN}{const e=this.tilesEstimatedHeight.get(t.groupID);return"number"==typeof e?e:t.getEstimatedTotalHeight()}}estimateWidgetWidth(e){const t=this.tiles.get(e);if(t instanceof c.Cell)return g.CELL_MIN_WIDTH;{const e=this.tilesEstimatedWidth.get(t.groupID);return"number"==typeof e?e:t.getEstimatedTotalWidth()}}set measuredAllUntilIndex(e){this._measuredAllUntilIndex=e}getEstimatedTotalSize(e="mode"){"mode"==e&&(e=this.direction);const t="row"==e?this._widgetSizersRow:this._widgetSizersCol;let i=0;if(this.measuredAllUntilIndex>=this.widgetCount&&(this.measuredAllUntilIndex=this.widgetCount-1),this.measuredAllUntilIndex>=0){const e=t[this.measuredAllUntilIndex];i=e.offset+e.size}let o=0;for(let e=this.measuredAllUntilIndex+1;e<this.widgetCount;e++){const i=t[e];o+=(null==i?void 0:i.measured)?i.size:this.estimateWidgetSize(e)}return i+o}getEstimatedTotalHeight(){if("col"==this.direction)return this.getEstimatedTotalSize("col");let e=0;for(let t=0;t<this.widgetCount;t++){const i=this._widgetSizersCol[t];e=Math.max(e,(null==i?void 0:i.measured)?i.size:this.estimateWidgetHeight(t))}return e}getEstimatedTotalWidth(){if("row"==this.direction)return this.getEstimatedTotalSize("row");let e=0;for(let t=0;t<this.widgetCount;t++){const i=this._widgetSizersRow[t];e=Math.max(e,(null==i?void 0:i.measured)?i.size:this.estimateWidgetWidth(t))}return e}get measuredAllUntilIndex(){return-1}getItemMetadata(e){var t;for(const i of["row","col"]){const o={row:this._widgetSizersRow,col:this._widgetSizersCol}[i];if(e>this.measuredAllUntilIndex){let s=0;if(this.measuredAllUntilIndex>=0){const e=o[this.measuredAllUntilIndex];s=e.offset+e.size}for(let n=this.measuredAllUntilIndex+1;n<=e;n++){let e,r=!1;if(null===(t=o[n])||void 0===t?void 0:t.measured)e=o[n].size,r=!0;else{const t=this.widgetRenderer(n);if((null==t?void 0:t.node)&&t.node.isConnected&&"none"!=t.node.style.display){const o=t.node.getBoundingClientRect();e=("row"==i?o.width:o.height)+parseFloat(getComputedStyle(t.node).margin),r=!0}else e="row"==i?this.estimateWidgetWidth(n):this.estimateWidgetHeight(n),r=!1}o[n]={offset:s,size:e,measured:r},s+=e}for(let t=e+1;t<o.length;t++){const e=o[t],i=o[t-1];e.offset=i.offset+i.size}}for(let e=0;e<=this.measuredAllUntilIndex;e++){const t=o[e];if(0===e){if(0!==t.offset)throw new Error("First offset is not null")}else{const i=o[e-1];if(t.offset!==i.offset+i.size)throw new Error(`Sizer ${e} has incorrect offset.`)}}}return"row"==this.direction?this._widgetSizersRow[e]:this._widgetSizersCol[e]}getRangeToRender(){const e=this.widgetCount;return[0,e-1,0,e-1]}}g.CELL_MIN_WIDTH=160,c.Cell;class m extends p.ObservableList{constructor(){super(),this.changed.connect((e,t)=>{})}splice(e,t,...i){const o=[];for(let i=0;i<t;i++)o.push(this.remove(e));for(let t=0;t<i.length;t++)this.insert(e+t,i[t]);return o}map(e){const t=[];for(let i=0;i<this.length;i++)t.push(e(this.get(i)));return t}indexOf(e){const t=this._itemCmp;return h.ArrayExt.findFirstIndex(this._array,i=>t(i,e))}removeValue(e){const t=this._itemCmp,i=h.ArrayExt.findFirstIndex(this._array,i=>t(i,e));return i<0||this.remove(i),i}}class f extends l.WindowedList{constructor(e,t="col"){const i=new m;super({model:new g(i,t,{overscanCount:f.defaultConfig.overscanCount,windowingActive:!0}),layout:new s.NotebookWindowedLayout,renderer:l.WindowedList.defaultRenderer,scrollbar:!1}),this.groupID=e,this._superMosaic=null,this._tabBar=null,this._activeTile=null,this.runButton=null,this._ready=new u.PromiseDelegate,this.tiles=i,this.mosaics=new Map,this._direction=t,this._mode=t,this._placeholder=!0,this.addClass(f.NODE_CLASS),this.tiles.changed.connect(this.onTreeChanged,this),this._onItemResize=this.onItemResize,this._updateTotalSize=this.updateTotalSize,this.viewportNode.addEventListener("scroll",e=>{this.onScroll(e),e.stopPropagation()}),this.viewportNode.addEventListener("scrollend",e=>{this.updateOverflowShadow(),e.stopPropagation()})}get notebook(){return this.superMosaic.notebook}get direction(){return this._direction}set direction(e){this._direction=e}get mode(){return this._mode}set mode(e){this._mode!==e&&(this._mode=e,"tabbed"===e?(this.viewModel.windowingActive=!1,this.node.classList.add(f.TAB_GROUP_CLASS),this.buildTabBar()):(this.viewModel.windowingActive=!0,this.node.classList.remove(f.TAB_GROUP_CLASS),this.destroyTabBar(),this.direction=e),this.viewModel.direction=this.direction,this.update())}get superMosaic(){return this._superMosaic}set superMosaic(e){null!==this._superMosaic&&e!==this._superMosaic&&this._superMosaic.tiles.removeValue(this),this._superMosaic=e}get path(){return[...null!==this.superMosaic?this.superMosaic.path:[],this.groupID]}get id(){return`mosaic:${this.path.join("/")}`}saveState(e){f.saveMosaicState(this.notebook,this.id,e)}loadState(){return f.loadMosaicState(this.notebook,this.id)}onTreeChanged(e,t){switch(t.type){case"clear":case"remove":if("tabbed"===this.mode)for(const e of t.oldValues)this.removeTab(e);setTimeout(()=>{this.checkEmpty()},250);break;case"set":case"add":if("tabbed"===this.mode){for(const e of t.newValues)this.addTab(e);!this._activeTile&&this.tiles.length>0&&this.setActiveTab(this.tiles.get(0))}for(const e of t.newValues)f.setParent(e,this),e instanceof f||e instanceof c.Cell&&(f.setPath(e,this.path),e.disposed.connect((e,t)=>{setTimeout(()=>this.checkEmpty(),250)}))}if(console.log(this.id,"wl indices",this.tiles.map(e=>e.node.dataset.windowedListIndex),this.layout.widgets.map(e=>e.node.dataset.windowedListIndex)),requestAnimationFrame(()=>this.update()),this.superMosaic){const e=this.superMosaic.tiles.indexOf(this);e>-1&&this.superMosaic.onTreeChanged(this.superMosaic.tiles,{type:"set",newIndex:e,newValues:[this],oldIndex:e,oldValues:[this]})}}treeGet(e,t=0){return t<e.length?this.mosaics.get(e[t]).treeGet(e,t+1):this}treeGetExisting(e,t=0){if(t<e.length){const i=this.mosaics.get(e[t]);return void 0!==i?i.treeGetExisting(e,t+1):[this,t]}return[this,t]}addTile(e="",t=-1){""==e&&(e=f.newUGID());const i=new f(e);return this.splice(t,0,i),i}growBranch(e,t=[],i=0){if(i<e.length){let o=this.mosaics.get(e[i]);return null==o&&(o=this.addTile(e[i],t.length>i?t[i]:-1)),o.growBranch(e,t,i+1)}return this}splice(e,t,...i){e<0&&(e=this.tiles.length),this.tiles.splice(e,t,...i)}checkEmpty(){if(this.tiles.length<2){const e=this.tiles.get(0);e&&e instanceof f&&e.unwrap(),this.unwrap()}}unwrap(){if(!this.superMosaic)return;const e=this.superMosaic.tiles.removeValue(this);this.tiles.length>0&&(console.log("im not empty"),this.superMosaic.tiles.splice(e,0,...this.tiles),console.log("gave to parent:",f.showMosaic(this.superMosaic)))}getLeaf(e){let t=1,i=0;e<0&&(t=-1,i=-1);for(const o of e>0?this.tiles:Array.from(this.tiles).reverse())if(o instanceof c.Cell){if(i==e)return[[this,o],i];i+=t}else{const[s,n]=o.getLeaf(e-i);if(null!==s)return[s,n];i+=t*n}return[null,i]}findGroup(e){for(const t in this.mosaics){if(this.mosaics.get(t).node===e)return[t];const i=this.mosaics.get(t).findGroup(e);if(null!==i)return[t,...i]}return null}isPlaceholder(){return this.placeholder}get placeholder(){return this._placeholder}set placeholder(e){console.warn("PLACEHOLDER SET"),this._placeholder!==e&&!1===e&&(this.initializeDOM(),this._placeholder=e,this._ready.resolve())}initializeDOM(){console.log("INITIALIZING DOM"),this.placeholder}get ready(){return this._ready.promise}async runAll(){var e;for(const t of this.tiles)if(t instanceof f)t.runAll();else if(t instanceof c.Cell){if(!this.notebook)return console.warn("No notebook! Cannot run cells");const i=(null===(e=this.notebook)||void 0===e?void 0:e.parent).sessionContext;if(t instanceof c.CodeCell)try{await c.CodeCell.execute(t,i)}catch(e){console.error("Cell exec err",e)}else t instanceof c.MarkdownCell&&(t.rendered=!0)}}onAfterAttach(e){this.update(),super.onAfterAttach(e),this.direction="col"==this.parent.direction?"row":"col",this.viewModel.direction=this.direction,this.viewportNode.dataset.mosaicDirection=this.direction,this.viewportNode.classList.add(f.INNER_GROUP_CLASS,f.DIR_CLASS[this.direction]),this.updateOverflowShadow(),this.runButton||(this.runButton=document.createElement("div"),this.runButton.appendChild(l.runIcon.element()),this.runButton.classList.add("mosaic-group-run-btn"),this.runButton.onclick=()=>this.runAll()),this.node.appendChild(this.runButton),this.loadState().tabbed?this.mode="tabbed":this.viewportNode.classList.remove(f.TAB_GROUP_CLASS),this.notebook&&this.notebook.activeCellChanged.connect(this.onActiveCellChanged,this);const t=this.loadState().elWidth;Number.isFinite(t)&&this.setElWidth(t);let i=!1;this.node.onmousedown=e=>{e.target===this.viewportNode&&(i=!0)};const o=e=>{if(i=!1,"row"==this.direction){const e=this.layout.widgets[0].node.getBoundingClientRect().width;this.saveState({...this.loadState(),elWidth:e})}};this.node.onmouseleave=o,this.node.onmouseup=o,this.node.onmousemove=e=>{if(i&&"row"==this.direction){const t=this.layout.widgets[0].node.getBoundingClientRect().width;this.setElWidth(t+e.movementX)}}}setElWidth(e){this.node.style.setProperty("--el-width",`${e}px`)}onBeforeDetach(e){this.notebook&&this.notebook.activeCellChanged.disconnect(this.onActiveCellChanged,this),super.onBeforeDetach(e)}onActiveCellChanged(e,t){if(t&&"tabbed"===this.mode){let e;for(const i of this.tiles){if(i===t){e=i;break}if(i instanceof f){let o=t.superMosaic;for(;o;){if(o===i){e=i;break}o=o.superMosaic}}if(e)break}e&&this.setActiveTab(e)}}buildTabBar(){this._tabBar&&this.destroyTabBar(),this._tabBar=document.createElement("div"),this._tabBar.classList.add(f.TAB_BAR_CLASS),this.innerElement.insertBefore(this._tabBar,this.viewportNode);for(const e of this.tiles)this.addTab(e);const e=document.createElement("div");e.textContent="+",e.classList.add("mosaic-add-tab-button"),e.onclick=()=>this.addNewCell(),this._tabBar.appendChild(e),requestAnimationFrame(()=>{for(let e=1;e<this.layout.widgets.length;e++)this.layout.widgets[e].hide();this.tiles.length>0&&this.setActiveTab(this.tiles.get(0))})}destroyTabBar(){this._tabBar&&(this._tabBar.remove(),this._tabBar=null);for(const e of this.tiles)e.show();this._activeTile=null}addTab(e){if(!this._tabBar)return;const t=document.createElement("div");t.classList.add(f.TAB_CLASS);const i=document.createElement("pre");t.appendChild(i),i.textContent=this.getTileTitle(e),t.onclick=()=>this.setActiveTab(e),e.__tab=t;const o=this._tabBar.querySelector(".mosaic-add-tab-button");o?this._tabBar.insertBefore(t,o):this._tabBar.appendChild(t)}removeTab(e){e.__tab&&e.__tab.remove()}setActiveTab(e){var t,i;if((this._activeTile!==e||e.isHidden)&&(this._activeTile&&(null===(t=this._activeTile.__tab)||void 0===t||t.classList.remove(f.TAB_ACTIVE_CLASS),this._activeTile.hide()),this._activeTile=e,this._activeTile&&(null===(i=this._activeTile.__tab)||void 0===i||i.classList.add(f.TAB_ACTIVE_CLASS),this._activeTile.show(),this.notebook))){let e=null;if(this._activeTile instanceof c.Cell)e=this._activeTile;else if(this._activeTile instanceof f){const[t]=this._activeTile.getLeaf(0);t&&(e=t[1])}if(e){const t=this.notebook.widgets.indexOf(e);t>-1&&(this.notebook.activeCellIndex=t)}}}getTileTitle(e){if(console.log("getting title for",e),e instanceof f)return console.log("mosaic.",e.getTileTitle(e.getLeaf(0)[0][1])),`${e.tiles.length} items: ${e.getTileTitle(e.getLeaf(0)[0][1])}`;{let t="";e instanceof c.CodeCell&&(console.log("code cell. prompt",e.prompt),t=`[${e.prompt}]: `||"");const i=e.model.sharedModel.getSource();return i.length>15?t+=i.slice(0,12).split("\n")[0]+"...":t+=i.split("\n")[0],console.log("title:",t),""===t.trim()&&(t="Cell"),t}}get mosaicNotebook(){let e=this;for(;e;){if(e instanceof y)return e;e=e.superMosaic}return null}addNewCell(){this.setActiveTab(this.getLeaf(-1)[0][1]),s.NotebookActions.insertBelow(this.notebook),this.update()}updateOverflowShadow(){"col"==this.direction?this.viewportNode.scrollTop<10?this.dataset.mosaicScrolledSide="top":this.viewportNode.scrollTop>this.viewportNode.scrollHeight-this.viewportNode.clientHeight-10?this.dataset.mosaicScrolledSide="bottom":this.dataset.mosaicScrolledSide="":"row"==this.direction&&(this.viewportNode.scrollLeft<10?this.dataset.mosaicScrolledSide="left":this.viewportNode.scrollLeft>this.viewportNode.scrollWidth-this.viewportNode.clientWidth-10?this.dataset.mosaicScrolledSide="right":this.dataset.mosaicScrolledSide="")}onResize(e){const t=this.viewModel.height;this.viewModel.height=e.height>=0?e.height:this.node.getBoundingClientRect().height,this.viewModel.height!==t&&this._updater.invoke(),super.onResize(e),this._updater.invoke()}onItemResize(e){if(this._resetScrollToItem(),!this.isHidden&&!this.isParentHidden)for(const t of["row","col"]){const i=[];for(let o of e){const e=("row"==t?o.borderBoxSize[0].inlineSize:o.borderBoxSize[0].blockSize)+2*parseFloat(getComputedStyle(o.target).margin);o.target.isConnected&&e>0&&i.push({index:parseInt(o.target.dataset.windowedListIndex,10),size:e})}this.viewModel.setWidgetSize(i,t)&&(this._scrollBackToItemOnResize(),this.update()),requestAnimationFrame(()=>this.update())}}get innerElement(){return this._innerElement}updateTotalSize(){if(this.viewModel.windowingActive){if("true"==this.viewportNode.dataset.isScrolling)return void(this._requiresTotalSizeUpdate=!0);let e=this.viewModel.getEstimatedTotalHeight();"row"==this.direction&&(e+=2*f.CSS.rowPaddingTop),this.innerElement.style.height=`${e}px`,this.viewportNode.scrollWidth>this.viewportNode.clientWidth||this.viewportNode.scrollHeight>this.viewportNode.clientHeight?(this.node.classList.add("mosaic-scrolling"),this.node.style.setProperty("--scroll-width",`${this.viewportNode.scrollWidth}px`),this.node.style.setProperty("--scroll-height",`${this.viewportNode.scrollHeight}px`)):this.node.classList.remove("mosaic-scrolling")}}getEstimatedTotalHeight(){return this.viewModel.getEstimatedTotalHeight()}getEstimatedTotalWidth(){return this.viewModel.getEstimatedTotalWidth()}renderCellOutputs(e){const t=this.viewModel.widgetRenderer(e);if(t instanceof c.CodeCell&&t.isPlaceholder()){const i=t;i.dataset.windowedListIndex=`${e}`,this.layout.insertWidget(e,i),requestAnimationFrame(()=>{this.layout.removeWidget(i)})}else if(t instanceof f&&t.isPlaceholder()){const e=t;for(let t=0;t<e.tiles.length;t++)e.renderCellOutputs(t)}}detachWidget(){}}f.METADATA_NAME="mosaic",f.NODE_CLASS="mosaic-group-outer",f.INNER_GROUP_CLASS="mosaic-group-inner",f.TAB_GROUP_CLASS="mosaic-tabgroup",f.TAB_BAR_CLASS="mosaic-tab-bar",f.TAB_CLASS="mosaic-tab",f.TAB_ACTIVE_CLASS="mosaic-tab-active",f.DIR_CLASS={row:"mosaic-row",col:"mosaic-col"},f.CSS={rowPaddingTop:5,colPaddingLeft:5},f.defaultConfig={overscanCount:3},function(e){e.showMosaic=function(t){return t instanceof e||t instanceof y?t.tiles._array.map(e.showMosaic):t instanceof c.Cell?"Cell:"+t.prompt:t},e.getPath=function(t){return t.model.getMetadata(e.METADATA_NAME)},e.setPath=function(t,i){return t.model.setMetadata(e.METADATA_NAME,i)},e.setParent=function(e,t){e.superMosaic&&e.superMosaic!==t&&e.superMosaic.tiles.removeValue(e),e.superMosaic=t},e.divergeDepth=function(e,t){if(null==e||null==t)return 0;for(let i=0;i<e.length;i++)if(t.length<=i||e[i]!==t[i])return i;return e.length},e.newUGID=function(){return"mg-"+crypto.randomUUID()},e.loadMosaicState=function(e,t){return e.model.getMetadata(t)||{}},e.saveMosaicState=function(e,t,i){e.model.setMetadata(t,i)}}(f||(f={}));const w="jp-mod-dropTarget",v="jp-Cell",b="application/vnd.jupyter.cells";function _(e,t){if(!t.mimeData.hasData(b))return;t.preventDefault(),t.stopPropagation(),t.dropAction=t.proposedAction;const i=e.node.getElementsByClassName(w);i.length&&i[0].classList.remove(w);let o=M(t.clientX,t.clientY),s="";for(;o&&o.parentElement&&!o.classList.contains(v)&&!o.classList.contains(f.NODE_CLASS);)o.classList.contains("jp-InputPrompt")&&(s="tab"),o=o.parentElement;o.classList.add(w),""==s&&(s=C(t,o,.25));let n=e._findCell(o);if(-1===n)o&&o.parentElement||(o=t.source.viewportNode,o.classList.add(w),o.dataset.mosaicDropSide="bottom");else{const t=e.cellsArray[n];t.node.classList.add(w),t.node.dataset.mosaicDropSide=s,o=t.node}t.mimeData.getData("internal:cells").map(e=>e.node).includes(o)&&(o.dataset.mosaicDropSide="");let r=t.target;for(;r&&r.parentElement;){if(r.classList.contains(f.INNER_GROUP_CLASS))if("row"===r.dataset.mosaicDirection){if(t.clientX<r.getBoundingClientRect().left+20&&r.scrollLeft>0){r.scrollBy({left:-20}),requestAnimationFrame(()=>{_(e,t)});break}if(t.clientX>r.getBoundingClientRect().right-20&&r.scrollLeft+r.clientWidth<r.scrollWidth){r.scrollBy({left:20}),requestAnimationFrame(()=>{_(e,t)});break}}else{if(t.clientY<r.getBoundingClientRect().top+20&&r.scrollTop>0){r.scrollBy({top:-20}),requestAnimationFrame(()=>{_(e,t)});break}if(t.clientY>r.getBoundingClientRect().bottom-20&&r.scrollTop+r.clientHeight<r.scrollHeight){r.scrollBy({top:20}),requestAnimationFrame(()=>{_(e,t)});break}}r=r.parentElement}}function C(e,t,i=0){const o=t.getBoundingClientRect(),s=e.clientX,n=e.clientY;let r=Math.abs(n-o.top),l=Math.abs(s-o.left),a=Math.abs(n-o.bottom),d=Math.abs(s-o.right);if(i>0){const e=o.width/o.height;r=(1-i)*r+i*r*e,a=(1-i)*a+i*a*e,l=(1-i)*l+i*l/e,d=(1-i)*d+i*d/e}switch(Math.min(r,l,a,d)){case r:return"top";case l:return"left";case a:return"bottom";case d:return"right";default:return"top"}}function M(e,t){const i=document.querySelectorAll(".lm-cursor-backdrop, .lm-DragImage");i.forEach(e=>e.style.visibility="hidden");const o=document.elementFromPoint(e,t);return i.forEach(e=>e.style.visibility=""),o}var L;!function(e){class t extends s.NotebookPanel.ContentFactory{createNotebook(e){return new y(e)}}e.ContentFactory=t}(L||(L={}));class y extends s.Notebook{constructor(e){var t,i;super(e),this.superMosaic=null,this.path=[],this.notebook=this,this.direction="col",this.addTile=f.prototype.addTile.bind(this),this.growBranch=f.prototype.growBranch.bind(this),this.splice=f.prototype.splice.bind(this),this.treeGetExisting=f.prototype.treeGetExisting.bind(this),this.getLeaf=f.prototype.getLeaf.bind(this),this.findGroup=f.prototype.findGroup.bind(this),this.renderCellOutputs=f.prototype.renderCellOutputs.bind(this),this.unwrap=()=>{},this.checkEmpty=()=>{},this.tiles=new m,this.mosaics=new Map,this.options={...e,direction:"col",notebook:this},this.notebook=this;const o=new g(this.tiles,"col",{overscanCount:null!==(i=null===(t=e.notebookConfig)||void 0===t?void 0:t.overscanCount)&&void 0!==i?i:f.defaultConfig.overscanCount,windowingActive:!0});Object.defineProperty(this.viewModel,"widgetCount",{get:o._getWidgetCount.bind(o)}),this.viewModel.estimateWidgetSize=o._estimateWidgetSize.bind(o),this.viewModel.widgetRenderer=o._widgetRenderer.bind(o),this._evtDrop=e=>function(e,t){var i;if(!t.mimeData.hasData(b))return;if(t.preventDefault(),t.stopPropagation(),"none"===t.proposedAction)return void(t.dropAction="none");let o=M(t.clientX,t.clientY);for(;o&&o.parentElement;){if(o.classList.contains(w)){o.classList.remove(w);break}o=o.parentElement}e.model;const n=t.source;if(n===e){t.dropAction="move";const r=t.mimeData.getData("internal:cells"),l=r[r.length-1];if(l instanceof c.MarkdownCell&&l.headingCollapsed){const e=s.NotebookActions.findNextParentHeading(l,n);if(e>0){const t=(0,h.findIndex)(n.widgets,e=>l.model.id===e.model.id);r.push(...n.widgets.slice(t+1,e))}}let a,d=h.ArrayExt.firstIndexOf(e.widgets,r[0]),u=e._findCell(o),p=[];if(u<0){for(;o&&o.parentElement;){if(o.classList.contains(f.NODE_CLASS)){o.classList.remove(w);break}o=o.parentElement}o&&o.parentElement||(u=-1,o=e.viewportNode,n.viewportNode.classList.remove(w))}const g=o.dataset.mosaicDropSide||C(t,o,.25),m="bottom"==g||"top"==g,b="left"==g||"right"==g,_="top"==g||"left"==g,M="bottom"==g||"right"==g||"tab"==g;if(u<0)if(o.classList.contains(f.NODE_CLASS)){const t=o.getElementsByClassName(v);if(u=e._findCell(t[_?0:t.length-1]),u<0)return;a=e.widgets[u],p=f.getPath(a),p.length>0&&(p=p.slice(0,p.length-1))}else a=e.widgets[e.widgets.length-1];else a=e.widgets[u],p=f.getPath(a)||[];const L=p.length%2==0?"col":"row";if("row"==L&&m||"col"==L&&b||"tab"==g&&!(null===(i=a.superMosaic)||void 0===i?void 0:i.tabbed)){const t=f.newUGID();p=[...p,t],f.setPath(a,p),"tab"==g&&(f.saveMosaicState(e,"mosaic:"+p.join("/"),{tabbed:!0}),console.log("saved tabbed!"),console.log("loaded:",f.loadMosaicState(e,"mosaic:"+p.join("/"))))}let y,S=0,A=f.getPath(r[0])||[];for(let e of r){const t=f.getPath(e);S=f.divergeDepth(t,A),A=t.slice(0,S)}r.length>1&&S%2!=p.length%2&&(y=f.newUGID());for(const e of r){const t=f.getPath(e);y&&t.splice(S,0,y),f.setPath(e,[...p,...t.slice(S)])}-1===u&&(u=e.widgets.length-1);let T=u;if(M&&(u+=1),u!==e.widgets.length-1&&-1!==u&&u>d&&(u-=1),u>=d&&u<d+r.length){T=Math.min(d,T),console.log("first changed cell",e.widgets[T].prompt);for(let t=0;t<r.length+1&&!(T+t>=e.widgets.length);t++)console.log("mos insert","Cell:"+e.widgets[T+t].prompt),e.mosaicInsert(T+t);return}u>d&&(T-=r.length),e.moveCell(d,u,r.length);for(let t=0;t<r.length+1&&!(T+t>=e.widgets.length);t++)console.log("mos insert","Cell:"+e.widgets[T+t].prompt),e.mosaicInsert(T+t)}}(this,e),this._evtDragOver=e=>_(this,e),this._updateForDeferMode=this._myupdateForDeferMode,this.tiles.changed.connect(this.onTreeChanged,this)}onTreeChanged(e,t){f.prototype.onTreeChanged.bind(this)(e,t),requestAnimationFrame(()=>this.update())}get model(){return super.model}set model(e){super.model=e,this.viewModel.itemsList=this.tiles}onCellInserted(e,t){super.onCellInserted(e,t),this.mosaicInsert(e)}onCellRemoved(e,t){super.onCellRemoved(e,t);const[i]=this.getLeaf(e);if(null!==i){const[o,s]=i;s==t?o.tiles.removeValue(s):console.warn("failed to remove",e,t)}}async _myupdateForDeferMode(e,t){const[i,o]=this.mosaicInsert(t);e.dataset.windowedListIndex=`${o}`,i.layout.insertWidget(o,e),await e.ready}graft(e,t,i,o,s,n=0){let r=i.superMosaic,l=i;for(let e=o.length;e>s;e--)l=r,r=l.superMosaic;let a=r.tiles.indexOf(l);if(a<0?(console.error("referrence leaf/branch missing!"),r=this,a=this.tiles.length):a+=n,s<t.length){const i=r.growBranch(t.slice(s),[a]);return console.log("grew",i),i.splice(0,0,e),[i,a]}return console.log("attaching to",r),r.splice(a,0,e),[r,a]}mosaicInsert(e){var t,i;const o=this.cellsArray[e-1],s=this.cellsArray[e],n=this.cellsArray[e+1];if(null==s)return console.warn("no cell at index!",e),[this,-1];f.setParent(s,null),s.parent=null;let r=null===(t=null==o?void 0:o.superMosaic)||void 0===t?void 0:t.path,l=f.getPath(s),a=null===(i=null==n?void 0:n.superMosaic)||void 0===i?void 0:i.path;if(0===e&&!n){const e=this.growBranch(l||[]);return e.splice(0,0,s),[e,0]}console.log("Cell:",s.prompt,"prev, this, next path",r,l,a,o,s,n),void 0===l&&(l=o&&r?r:[]);let d=(null==o?void 0:o.superMosaic)?f.divergeDepth(r,l):-1,c=(null==n?void 0:n.superMosaic)?f.divergeDepth(a,l):-1;if(o&&o.superMosaic){let e=o;for(let t=d;t<((null==r?void 0:r.length)||-1);t++)e=e.superMosaic,null==e||e.checkEmpty();r=o.superMosaic.path,d=o.superMosaic?f.divergeDepth(r,l):-1}if(n&&n.superMosaic){let e=n;for(let t=c;t<((null==a?void 0:a.length)||-1);t++)e=e.superMosaic,null==e||e.checkEmpty();a=n.superMosaic.path,c=n.superMosaic?f.divergeDepth(a,l):-1}if(d<0&&c<0)throw new Error("both neighbors unattached! unable to graft");switch(Math.max(d,c)){case d:return console.log("grafting to prev"),this.graft(s,l,o,r,d,1);case c:return console.log("grafting to next"),this.graft(s,l,n,a,c,0);default:throw new Error("invalid path divergence!")}}}n.DocumentManager.prototype.openOrReveal=function(e,t=null,i,o){const s=this.findWidget(e,t);return s?(this._opener.open(s,{type:t||"default",...o}),s):this.open(e,t||"default",i,null!=o?o:{})};const S=new l.LabIcon({name:"mosaic:favicon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" zoomAndPan="magnify" viewBox="0 0 224.87999 225" height="300" preserveAspectRatio="xMidYMid meet" version="1.0"><defs><clipPath id="c77da14a9c"><path d="M 5.695312 6.648438 L 218.421875 6.648438 L 218.421875 219.207031 L 5.695312 219.207031 Z M 5.695312 6.648438 " clip-rule="nonzero"/></clipPath><clipPath id="23beb3cc63"><path d="M 41.148438 41.0625 L 82.5625 41.0625 L 82.5625 112.921875 L 41.148438 112.921875 Z M 41.148438 41.0625 " clip-rule="nonzero"/></clipPath><clipPath id="16c2531e20"><path d="M 0.148438 0.0625 L 41.5625 0.0625 L 41.5625 71.921875 L 0.148438 71.921875 Z M 0.148438 0.0625 " clip-rule="nonzero"/></clipPath><clipPath id="29353f2a72"><rect x="0" width="42" y="0" height="72"/></clipPath><clipPath id="d8aae63389"><path d="M 116.046875 41.070312 L 185.339844 41.070312 L 185.339844 113 L 116.046875 113 Z M 116.046875 41.070312 " clip-rule="nonzero"/></clipPath><clipPath id="cfc5a793f8"><path d="M 185.339844 41.070312 L 185.339844 112.929688 L 150.691406 86.902344 L 116.046875 112.929688 L 116.046875 41.070312 Z M 185.339844 41.070312 " clip-rule="nonzero"/></clipPath><clipPath id="220cefa82e"><path d="M 0.046875 0.0703125 L 69.339844 0.0703125 L 69.339844 72 L 0.046875 72 Z M 0.046875 0.0703125 " clip-rule="nonzero"/></clipPath><clipPath id="3c90225054"><path d="M 69.339844 0.0703125 L 69.339844 71.929688 L 34.691406 45.902344 L 0.046875 71.929688 L 0.046875 0.0703125 Z M 69.339844 0.0703125 " clip-rule="nonzero"/></clipPath><clipPath id="d9c4b89bd7"><rect x="0" width="70" y="0" height="72"/></clipPath><clipPath id="c86cb4a01a"><path d="M 41.144531 140.367188 L 82.5625 140.367188 L 82.5625 182 L 41.144531 182 Z M 41.144531 140.367188 " clip-rule="nonzero"/></clipPath><clipPath id="a9614c8938"><path d="M 0.144531 0.367188 L 41.5625 0.367188 L 41.5625 42 L 0.144531 42 Z M 0.144531 0.367188 " clip-rule="nonzero"/></clipPath><clipPath id="61a8371438"><rect x="0" width="42" y="0" height="42"/></clipPath><clipPath id="ad4c9c5550"><path d="M 116.042969 140.371094 L 185.335938 140.371094 L 185.335938 182.003906 L 116.042969 182.003906 Z M 116.042969 140.371094 " clip-rule="nonzero"/></clipPath><clipPath id="414381d676"><path d="M 0.0429688 0.371094 L 69.335938 0.371094 L 69.335938 42.003906 L 0.0429688 42.003906 Z M 0.0429688 0.371094 " clip-rule="nonzero"/></clipPath><clipPath id="f52a3b91bf"><rect x="0" width="70" y="0" height="43"/></clipPath></defs><g clip-path="url(#c77da14a9c)"><path stroke-linecap="butt" transform="matrix(0, -0.7496, 0.7496, 0, 5.69527, 219.20806)" fill="none" stroke-linejoin="miter" d="M 0.00137291 0.0000562556 L 283.564089 0.0000562556 L 283.564089 283.78685 L 0.00137291 283.78685 Z M 0.00137291 0.0000562556 " stroke="#f7672c" stroke-width="52" stroke-opacity="1" stroke-miterlimit="4"/></g><g clip-path="url(#23beb3cc63)"><g transform="matrix(1, 0, 0, 1, 41, 41)"><g clip-path="url(#29353f2a72)"><g clip-path="url(#16c2531e20)"><path fill="#ffad31" d="M 0.148438 71.921875 L 0.148438 0.09375 L 41.5625 0.09375 L 41.5625 71.921875 Z M 0.148438 71.921875 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g><g clip-path="url(#d8aae63389)"><g clip-path="url(#cfc5a793f8)"><g transform="matrix(1, 0, 0, 1, 116, 41)"><g clip-path="url(#d9c4b89bd7)"><g clip-path="url(#220cefa82e)"><g clip-path="url(#3c90225054)"><path fill="#f7672c" d="M 0.046875 0.0703125 L 69.339844 0.0703125 L 69.339844 71.800781 L 0.046875 71.800781 Z M 0.046875 0.0703125 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g></g></g><g clip-path="url(#c86cb4a01a)"><g transform="matrix(1, 0, 0, 1, 41, 140)"><g clip-path="url(#61a8371438)"><g clip-path="url(#a9614c8938)"><path fill="#ff914d" d="M 0.144531 42 L 0.144531 0.425781 L 41.5625 0.425781 L 41.5625 42 Z M 0.144531 42 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g><g clip-path="url(#ad4c9c5550)"><g transform="matrix(1, 0, 0, 1, 116, 140)"><g clip-path="url(#f52a3b91bf)"><g clip-path="url(#414381d676)"><path fill="#ffad31" d="M 0.0429688 42.003906 L 0.0429688 0.371094 L 69.324219 0.371094 L 69.324219 42.003906 Z M 0.0429688 42.003906 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g></svg>'.toString()}),A="MosaicNotebook";class T extends s.NotebookModelFactory{get name(){return"mosaic-notebook"}}function k(e){e.skeuomorphic?document.body.classList.add("mosaic-skeuomorphic"):document.body.classList.remove("mosaic-skeuomorphic"),e.topCellHandle?document.body.classList.add("mosaic-top-cell-handles"):document.body.classList.remove("mosaic-top-cell-handles")}const E={id:"mosaic:plugin",description:"Arrange Jupyter notebook cells in any way two-dimensionally. Present your code compactly in Zoom video confrences. Let your Jupyter notebook tell the story and be self-documenting in itself, like a poster presentation. Eliminate white space in your notebook and take advantage of unused screen real estate.",autoStart:!0,requires:[s.INotebookTracker,r.ILauncher,o.IEditorServices,a.ILayoutRestorer,n.IDocumentManager,d.ISettingRegistry],optional:[],activate:async(e,t,i,o,n,r,l)=>{console.log("JupyterLab extension mosaic is activated!");const a=await l.load(E.id);k(a.composite),a.changed.connect(()=>{k(a.composite)});const d=e=>e.content instanceof y?A:"Notebook";t._pool._restore.args=e=>({path:e.context.path,factory:d(e)}),t._pool._restore.name=e=>`${e.context.path}:${d(e)}`,e.serviceManager.workspaces.list().then(e=>{console.log("WORKSPACES",e)});const c=r._createContext.bind(r);r._createContext=(e,i,...o)=>{const s=t.find(t=>t.context.path==e);return void 0!==s?s.context:c(e,i)};const h=e.docRegistry.getWidgetFactory("Notebook"),u=new T({disableDocumentWideUndoRedo:!1});e.docRegistry.addModelFactory(u);const p=new s.NotebookWidgetFactory({name:A,fileTypes:["notebook"],defaultFor:["notebook"],modelName:"mosaic-notebook",preferKernel:!0,canStartKernel:!0,rendermime:h.rendermime,contentFactory:new L.ContentFactory({editorFactory:o.factoryService.newInlineEditor}),mimeTypeService:h.mimeTypeService,toolbarFactory:h._toolbarFactory});p.widgetCreated.connect((e,i)=>{t.add(i),i.title.icon=S}),e.docRegistry.addWidgetFactory(p),e.docRegistry.setDefaultWidgetFactory("notebook",A);for(const t of e.docRegistry.widgetExtensions("Notebook"))e.docRegistry.addWidgetExtension(A,t);e.commands.addCommand("mosaic-notebook:create-new",{label:t=>{var i,o;return`Mosaic ${(null===(o=null===(i=e.serviceManager.kernelspecs.specs)||void 0===i?void 0:i.kernelspecs[t.kernelName])||void 0===o?void 0:o.display_name)||""}`},caption:"Create a new Mosaic Notebook",execute:async({kernelName:t})=>{const i=await e.commands.execute("docmanager:new-untitled",{type:"notebook"});return e.commands.execute("docmanager:open",{path:i.path,factory:A,kernel:{name:t}})},icon:S,iconLabel:"Mosaic Notebook"});for(const t in e.serviceManager.kernelspecs.specs.kernelspecs){const o=e.serviceManager.kernelspecs.specs.kernelspecs[t];i.add({command:"mosaic-notebook:create-new",args:{kernelName:t},category:"Notebook",rank:0,kernelIconUrl:`${o.resources["logo-svg"]}`})}}},x=E}}]);