"use strict";(self.webpackChunkmosaic=self.webpackChunkmosaic||[]).push([[302],{302:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var o=i(333),s=i(722),n=i(794),r=i(273),l=i(222),a=i(296),d=i(219),c=i(49),h=i(53),p=i(262),g=i(227);class u extends s.NotebookViewModel{constructor(e,t,i){super([],i),this.direction=t,this.tilesEstimatedWidth=new Map,this.tilesEstimatedHeight=new Map,this._widgetSizersRow=[],this._widgetSizersCol=[],this._tiles=null,this.widgetRenderer=u.prototype._widgetRenderer.bind(this),this.estimateWidgetSize=u.prototype._estimateWidgetSize.bind(this),this.tiles=e,Object.defineProperty(this,"_widgetSizers",{get(){return"row"==this.direction?this._widgetSizersRow:"col"==this.direction?this._widgetSizersCol:void 0}}),this._getItemMetadata=this.getItemMetadata}set tiles(e){this._tiles=e,this.itemsList=e}get tiles(){return this._tiles}onListChanged(e,t){return super.onListChanged(e,t)}_getWidgetCount(){var e;return(null===(e=this.tiles)||void 0===e?void 0:e.length)||0}get widgetCount(){return this._getWidgetCount()}_widgetRenderer(e){return this.tiles.get(e)}setWidgetSize(e,t="mode"){return"mode"==t&&(t=this.direction),super.setWidgetSize.bind(new Proxy(this,{get:(e,i,o)=>"_widgetSizers"==i?"row"==t?e._widgetSizersRow:e._widgetSizersCol:Reflect.get(e,i,o)}))(e)}_estimateWidgetSize(e){var t;return(null===(t=this.tiles)||void 0===t?void 0:t.get(e))?"row"==this.direction?this.estimateWidgetWidth(e):this.estimateWidgetHeight(e):(console.warn(`estimateWidgetSize requested for item ${e} in mosaic with only ${this.widgetCount} items`),0)}estimateWidgetHeight(e){const t=this.tiles.get(e);if(t instanceof c.Cell){const e=t.model,i=this.tilesEstimatedHeight.get(e.id);if("number"==typeof i)return i;const o=e.sharedModel.getSource().split("\n").length;let n=0;if(e instanceof c.CodeCellModel&&!e.isDisposed)for(let t=0;t<e.outputs.length;t++){const i=e.outputs.get(t).data["text/plain"];"string"==typeof i?n+=i.split("\n").length:Array.isArray(i)&&(n+=i.join("").split("\n").length)}return s.NotebookViewModel.DEFAULT_EDITOR_LINE_HEIGHT*(o+n)+s.NotebookViewModel.DEFAULT_CELL_MARGIN}{const e=this.tilesEstimatedHeight.get(t.groupID);return"number"==typeof e?e:t.getEstimatedTotalHeight()}}estimateWidgetWidth(e){const t=this.tiles.get(e);if(t instanceof c.Cell)return u.CELL_MIN_WIDTH;{const e=this.tilesEstimatedWidth.get(t.groupID);return"number"==typeof e?e:t.getEstimatedTotalWidth()}}set measuredAllUntilIndex(e){this._measuredAllUntilIndex=e}getEstimatedTotalSize(e="mode"){"mode"==e&&(e=this.direction);const t="row"==e?this._widgetSizersRow:this._widgetSizersCol;let i=0;if(this.measuredAllUntilIndex>=this.widgetCount&&(this.measuredAllUntilIndex=this.widgetCount-1),this.measuredAllUntilIndex>=0){const e=t[this.measuredAllUntilIndex];i=e.offset+e.size}let o=0;for(let e=this.measuredAllUntilIndex+1;e<this.widgetCount;e++){const i=t[e];o+=(null==i?void 0:i.measured)?i.size:this.estimateWidgetSize(e)}return i+o}getEstimatedTotalHeight(){if("col"==this.direction)return this.getEstimatedTotalSize("col");let e=0;for(let t=0;t<this.widgetCount;t++){const i=this._widgetSizersCol[t];e=Math.max(e,(null==i?void 0:i.measured)?i.size:this.estimateWidgetHeight(t))}return e}getEstimatedTotalWidth(){if("row"==this.direction)return this.getEstimatedTotalSize("row");let e=0;for(let t=0;t<this.widgetCount;t++){const i=this._widgetSizersRow[t];e=Math.max(e,(null==i?void 0:i.measured)?i.size:this.estimateWidgetWidth(t))}return e}get measuredAllUntilIndex(){return-1}getItemMetadata(e){var t;for(const i of["row","col"]){const o={row:this._widgetSizersRow,col:this._widgetSizersCol}[i];if(e>this.measuredAllUntilIndex){let s=0;if(this.measuredAllUntilIndex>=0){const e=o[this.measuredAllUntilIndex];s=e.offset+e.size}for(let n=this.measuredAllUntilIndex+1;n<=e;n++){let e,r=!1;if(null===(t=o[n])||void 0===t?void 0:t.measured)e=o[n].size,r=!0;else{const t=this.widgetRenderer(n);if((null==t?void 0:t.node)&&t.node.isConnected&&"none"!=t.node.style.display){const o=t.node.getBoundingClientRect();e="row"==i?o.width:o.height,r=!0}else e="row"==i?this.estimateWidgetWidth(n):this.estimateWidgetHeight(n),r=!1}o[n]={offset:s,size:e,measured:r},s+=e}for(let t=e+1;t<o.length;t++){const e=o[t],i=o[t-1];e.offset=i.offset+i.size}}for(let e=0;e<=this.measuredAllUntilIndex;e++){const t=o[e];if(0===e){if(0!==t.offset)throw new Error("First offset is not null")}else{const i=o[e-1];if(t.offset!==i.offset+i.size)throw new Error(`Sizer ${e} has incorrect offset.`)}}}return"row"==this.direction?this._widgetSizersRow[e]:this._widgetSizersCol[e]}getRangeToRender(){const e=this.widgetCount;return[0,e-1,0,e-1]}}u.CELL_MIN_WIDTH=160;const m='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100" zoomAndPan="magnify" viewBox="0 0 75.119995 83.04" height="100" preserveAspectRatio="xMidYMid meet" version="1.0"><path stroke-linecap="butt" transform="matrix(-0.741316, 0, 0, -0.741316, 31.434255, 39.666708)" fill="none" stroke-linejoin="miter" d="M 0.000891447 3.502415 L 27.780891 3.502415 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/><path stroke-linecap="round" transform="matrix(-0.741316, 0, 0, -0.741316, 31.434255, 39.666708)" fill="none" stroke-linejoin="round" d="M 13.780235 -6.999394 L 27.780891 3.502415 L 13.780235 13.998955 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/><path stroke-linecap="butt" transform="matrix(0.741316, 0, 0, 0.741316, 43.530141, 34.477498)" fill="none" stroke-linejoin="miter" d="M 0.00149535 3.497585 L 27.781495 3.497585 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/><path stroke-linecap="round" transform="matrix(0.741316, 0, 0, 0.741316, 43.530141, 34.477498)" fill="none" stroke-linejoin="round" d="M 13.780839 -6.998955 L 27.781495 3.497585 L 13.780839 13.999394 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/></svg>';c.Cell;class f extends g.ObservableList{constructor(){super(),this.changed.connect((e,t)=>{})}splice(e,t,...i){const o=[];for(let i=0;i<t;i++)o.push(this.remove(e));for(let t=0;t<i.length;t++)this.insert(e+t,i[t]);return o}map(e){const t=[];for(let i=0;i<this.length;i++)t.push(e(this.get(i)));return t}indexOf(e){const t=this._itemCmp;return h.ArrayExt.findFirstIndex(this._array,i=>t(i,e))}removeValue(e){const t=this._itemCmp,i=h.ArrayExt.findFirstIndex(this._array,i=>t(i,e));return i<0||this.remove(i),i}}class w extends l.WindowedList{constructor(e,t="col"){const i=new f;super({model:new u(i,t,{overscanCount:w.defaultConfig.overscanCount,windowingActive:!0}),layout:new s.NotebookWindowedLayout,renderer:l.WindowedList.defaultRenderer,scrollbar:!1}),this.groupID=e,this._superMosaic=null,this._ready=new p.PromiseDelegate,this.tiles=i,this.mosaics=new Map,this._direction=t,this._placeholder=!0,this.addClass(w.NODE_CLASS),this.tiles.changed.connect(this.onTreeChanged,this),this._onItemResize=this.onItemResize,this._updateTotalSize=this.updateTotalSize,this.expandButton=document.createElement("div"),this.node.appendChild(this.expandButton),this.expandButton.classList.add("mosaic-rowexapnd-btn"),this.expandButton.innerHTML=m.toString().replace(/stroke="[^"]*"/g,'stroke="currentColor"'),this.expandButton.onclick=()=>{console.warn("CLICK!"),this.viewportNode.classList.contains(w.ROWEXPAND_CLASS)?(this.expandButton.innerHTML=m.toString().replace(/stroke="[^"]*"/g,'stroke="currentColor"'),this.viewportNode.classList.remove(w.ROWEXPAND_CLASS)):(this.expandButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100" zoomAndPan="magnify" viewBox="0 0 75.119995 83.04" height="100" preserveAspectRatio="xMidYMid meet" version="1.0"><path stroke-linecap="butt" transform="matrix(0.741316, 0, 0, 0.741316, 8.256556, 34.477498)" fill="none" stroke-linejoin="miter" d="M 0.00169543 3.497585 L 27.781695 3.497585 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/><path stroke-linecap="round" transform="matrix(0.741316, 0, 0, 0.741316, 8.256556, 34.477498)" fill="none" stroke-linejoin="round" d="M 13.781039 -6.998955 L 27.781695 3.497585 L 13.781039 13.999394 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/><path stroke-linecap="butt" transform="matrix(-0.741316, 0, 0, -0.741316, 66.707836, 39.666708)" fill="none" stroke-linejoin="miter" d="M 0.00108577 3.502415 L 27.781085 3.502415 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/><path stroke-linecap="round" transform="matrix(-0.741316, 0, 0, -0.741316, 66.707836, 39.666708)" fill="none" stroke-linejoin="round" d="M 13.780429 -6.999394 L 27.781085 3.502415 L 13.780429 13.998955 " stroke="#000000" stroke-width="7" stroke-opacity="1" stroke-miterlimit="4"/></svg>'.toString().replace(/stroke="[^"]*"/g,'stroke="currentColor"'),this.viewportNode.classList.add(w.ROWEXPAND_CLASS))},console.warn(this.expandButton)}get direction(){return this._direction}set direction(e){this._direction=e,"col"==e?this.expandButton.style.display="none":"row"==e&&(this.expandButton.style.display="")}get superMosaic(){return this._superMosaic}set superMosaic(e){null!==this._superMosaic&&e!==this._superMosaic&&this._superMosaic.tiles.removeValue(this),this._superMosaic=e}get path(){return[...null!==this.superMosaic?this.superMosaic.path:[],this.groupID]}onTreeChanged(e,t){switch(t.type){case"clear":case"remove":setTimeout(()=>{this.checkEmpty()},250);break;case"set":case"add":for(const e of t.newValues)w.setParent(e,this),e instanceof w||e instanceof c.Cell&&(w.setPath(e,this.path),e.disposed.connect((e,t)=>{console.log("dispose!"),setTimeout(()=>this.checkEmpty(),250)}))}if(requestAnimationFrame(()=>this.update()),this.superMosaic){const e=this.superMosaic.tiles.indexOf(this);e>-1&&this.superMosaic.onTreeChanged(this.superMosaic.tiles,{type:"set",newIndex:e,newValues:[this],oldIndex:e,oldValues:[this]})}}treeGet(e,t=0){return t<e.length?this.mosaics.get(e[t]).treeGet(e,t+1):this}treeGetExisting(e,t=0){if(t<e.length){const i=this.mosaics.get(e[t]);return void 0!==i?i.treeGetExisting(e,t+1):[this,t]}return[this,t]}addTile(e="",t=-1){""==e&&(e=w.newUGID());const i=new w(e);return this.splice(t,0,i),i}growBranch(e,t=[],i=0){if(i<e.length){let o=this.mosaics.get(e[i]);return null==o&&(o=this.addTile(e[i],t.length>i?t[i]:-1)),o.growBranch(e,t,i+1)}return this}splice(e,t,...i){e<0&&(e=this.tiles.length),this.tiles.splice(e,t,...i)}checkEmpty(){if(this.tiles.length<2){const e=this.tiles.get(0);e&&e instanceof w&&e.unwrap(),this.unwrap()}}unwrap(){if(!this.superMosaic)return;const e=this.superMosaic.tiles.removeValue(this);this.tiles.length>0&&(console.log("im not empty"),this.superMosaic.tiles.splice(e,0,...this.tiles),console.log("gave to parent:",w.showMosaic(this.superMosaic)))}getLeaf(e){let t=0;for(const i of this.tiles)if(i instanceof c.Cell){if(t==e)return[[this,i],t];t+=1}else{const[o,s]=i.getLeaf(e-t);if(null!==o)return[o,s];t+=s}return[null,t]}findGroup(e){for(const t in this.mosaics){if(this.mosaics.get(t).node===e)return[t];const i=this.mosaics.get(t).findGroup(e);if(null!==i)return[t,...i]}return null}isPlaceholder(){return this.placeholder}get placeholder(){return this._placeholder}set placeholder(e){console.warn("PLACEHOLDER SET"),this._placeholder!==e&&!1===e&&(this.initializeDOM(),this._placeholder=e,this._ready.resolve())}initializeDOM(){console.log("INITIALIZING DOM"),this.placeholder}get ready(){return this._ready.promise}onAfterAttach(e){this.update(),super.onAfterAttach(e),this.direction="col"==this.parent.direction?"row":"col",this.viewModel.direction=this.direction,this.viewportNode.classList.add(w.INNER_GROUP_CLASS,w.DIR_CLASS[this.direction])}onScroll(e){if(super.onScroll(e),"row"==this.direction){const{clientWidth:t,scrollWidth:i,scrollLeft:o}=e.currentTarget;if(Math.abs(this.viewModel.scrollOffset-o)>1){const e=Math.max(0,Math.min(o,i-t));this.viewModel.scrollOffset=e,this.viewModel.windowingActive&&this.update()}}}onResize(e){const t=this.viewModel.height;this.viewModel.height=e.height>=0?e.height:this.node.getBoundingClientRect().height,this.viewModel.height!==t&&this._updater.invoke(),super.onResize(e),this._updater.invoke()}onItemResize(e){if(this._resetScrollToItem(),!this.isHidden&&!this.isParentHidden)for(const t of["row","col"]){const i=[];for(let o of e){const e="row"==t?o.borderBoxSize[0].inlineSize:o.borderBoxSize[0].blockSize;o.target.isConnected&&e>0&&i.push({index:parseInt(o.target.dataset.windowedListIndex,10),size:e})}this.viewModel.setWidgetSize(i,t)&&(this._scrollBackToItemOnResize(),this.update()),requestAnimationFrame(()=>this.update())}}get innerElement(){return this._innerElement}updateTotalSize(){if(this.viewModel.windowingActive){if("true"==this.viewportNode.dataset.isScrolling)return void(this._requiresTotalSizeUpdate=!0);let e=this.viewModel.getEstimatedTotalHeight();"row"==this.direction&&(e+=2*w.CSS.rowPaddingTop),this.innerElement.style.height=`${e}px`,this.viewportNode.scrollWidth>this.viewportNode.clientWidth||this.viewportNode.scrollHeight>this.viewportNode.clientHeight?(this.viewportNode.classList.add("mosaic-scrolling"),this.viewportNode.style.setProperty("--scroll-width",`${this.viewportNode.scrollWidth}px`),this.viewportNode.style.setProperty("--scroll-height",`${this.viewportNode.scrollHeight}px`)):this.viewportNode.classList.remove("mosaic-scrolling")}}getEstimatedTotalHeight(){return this.viewModel.getEstimatedTotalHeight()}getEstimatedTotalWidth(){return this.viewModel.getEstimatedTotalWidth()}renderCellOutputs(e){const t=this.viewModel.widgetRenderer(e);if(t instanceof c.CodeCell&&t.isPlaceholder()){const i=t;i.dataset.windowedListIndex=`${e}`,this.layout.insertWidget(e,i),requestAnimationFrame(()=>{this.layout.removeWidget(i)})}else if(t instanceof w&&t.isPlaceholder()){const e=t;for(let t=0;t<e.tiles.length;t++)e.renderCellOutputs(t)}}detachWidget(){}}w.METADATA_NAME="mosaic",w.NODE_CLASS="mosaic-group-outer",w.ROWEXPAND_CLASS="mosaic-rowexpand",w.INNER_GROUP_CLASS="mosaic-group-inner",w.DIR_CLASS={row:"mosaic-row",col:"mosaic-col"},w.CSS={rowPaddingTop:5,colPaddingLeft:5},w.defaultConfig={overscanCount:3},function(e){e.showMosaic=function(t){return t instanceof e||t instanceof C?t.tiles._array.map(e.showMosaic):t instanceof c.Cell?"Cell:"+t.prompt:t},e.getPath=function(t){return t.model.getMetadata(e.METADATA_NAME)},e.setPath=function(t,i){return t.model.setMetadata(e.METADATA_NAME,i)},e.setParent=function(e,t){e.superMosaic&&e.superMosaic!==t&&e.superMosaic.tiles.removeValue(e),e.superMosaic=t},e.divergeDepth=function(e,t){for(let i=0;i<e.length;i++)if(t.length<=i||e[i]!==t[i])return i;return e.length},e.newUGID=function(){return"mg-"+crypto.randomUUID()}}(w||(w={}));const M="jp-mod-dropTarget",v="jp-Cell",L="application/vnd.jupyter.cells";function k(e,t){const i=t.getBoundingClientRect(),o=e.clientX,s=e.clientY,n=Math.abs(s-i.top),r=Math.abs(o-i.left),l=Math.abs(s-i.bottom),a=Math.abs(o-i.right);switch(Math.min(n,r,l,a)){case n:return"top";case r:return"left";case l:return"bottom";case a:return"right";default:return"top"}}var y;!function(e){class t extends s.NotebookPanel.ContentFactory{createNotebook(e){return new C(e)}}e.ContentFactory=t}(y||(y={}));class C extends s.Notebook{constructor(e){var t,i;super(e),this.superMosaic=null,this.path=[],this.direction="col",this.addTile=w.prototype.addTile.bind(this),this.growBranch=w.prototype.growBranch.bind(this),this.splice=w.prototype.splice.bind(this),this.treeGetExisting=w.prototype.treeGetExisting.bind(this),this.getLeaf=w.prototype.getLeaf.bind(this),this.findGroup=w.prototype.findGroup.bind(this),this.renderCellOutputs=w.prototype.renderCellOutputs.bind(this),this.unwrap=()=>{},this.checkEmpty=()=>{},this.tiles=new f,this.mosaics=new Map,this.options={...e,direction:"col",notebook:this},this.notebook=this;const o=new u(this.tiles,"col",{overscanCount:null!==(i=null===(t=e.notebookConfig)||void 0===t?void 0:t.overscanCount)&&void 0!==i?i:w.defaultConfig.overscanCount,windowingActive:!0});Object.defineProperty(this.viewModel,"widgetCount",{get:o._getWidgetCount.bind(o)}),this.viewModel.estimateWidgetSize=o._estimateWidgetSize.bind(o),this.viewModel.widgetRenderer=o._widgetRenderer.bind(o),this._evtDrop=e=>function(e,t){if(!t.mimeData.hasData(L))return;if(t.preventDefault(),t.stopPropagation(),"none"===t.proposedAction)return void(t.dropAction="none");let i=t.target;for(;i&&i.parentElement;){if(i.classList.contains(M)){i.classList.remove(M);break}i=i.parentElement}e.model;const o=t.source;if(o===e){t.dropAction="move";const n=t.mimeData.getData("internal:cells"),r=n[n.length-1];if(r instanceof c.MarkdownCell&&r.headingCollapsed){const e=s.NotebookActions.findNextParentHeading(r,o);if(e>0){const t=(0,h.findIndex)(o.widgets,e=>r.model.id===e.model.id);n.push(...o.widgets.slice(t+1,e))}}let l,a=h.ArrayExt.firstIndexOf(e.widgets,n[0]),d=e._findCell(i),p=[];if(d<0){for(;i&&i.parentElement;){if(i.classList.contains(w.NODE_CLASS)){i.classList.remove(M);break}i=i.parentElement}i&&i.parentElement||(d=-1,i=e.viewportNode,o.viewportNode.classList.remove(M))}const g=i.dataset.mosaicDropSide||k(t,i),u="bottom"==g||"top"==g,m="left"==g||"right"==g,f="top"==g||"left"==g,L="bottom"==g||"right"==g;if(d<0)if(i.classList.contains(w.NODE_CLASS)){const t=i.getElementsByClassName(v);if(d=e._findCell(t[f?0:t.length-1]),d<0)return;l=e.widgets[d],p=w.getPath(l),p.length>0&&(p=p.slice(0,p.length-1))}else l=e.widgets[e.widgets.length-1];else l=e.widgets[d],p=w.getPath(l)||[];const y=p.length%2==0?"col":"row";("row"==y&&u||"col"==y&&m)&&(p=[...p,w.newUGID()],l.model.setMetadata(w.METADATA_NAME,p));let C,b=0,x=w.getPath(n[0])||[];for(let e of n){const t=w.getPath(e);b=w.divergeDepth(t,x),x=t.slice(0,b)}n.length>1&&b%2!=p.length%2&&(C=w.newUGID());for(const e of n){const t=w.getPath(e);C&&t.splice(b,0,C),w.setPath(e,[...p,...t.slice(b)])}-1===d&&(d=e.widgets.length-1);let _=d;if(L&&(d+=1),d!==e.widgets.length-1&&-1!==d&&d>a&&(d-=1),d>=a&&d<a+n.length){_=Math.min(a,_),console.log("first changed cell",e.widgets[_].prompt);for(let t=0;t<n.length+1;t++)console.log("mos insert","Cell:"+e.widgets[_+t].prompt),e.mosaicInsert(_+t);return}e.moveCell(a,d,n.length),d>a&&(_-=n.length),console.log("first changed cell",e.widgets[_].prompt);for(let t=0;t<n.length+1;t++)console.log("mos insert","Cell:"+e.widgets[_+t].prompt),e.mosaicInsert(_+t)}}(this,e),this._evtDragOver=e=>function(e,t){if(!t.mimeData.hasData(L))return;t.preventDefault(),t.stopPropagation(),t.dropAction=t.proposedAction;const i=e.node.getElementsByClassName(M);i.length&&i[0].classList.remove(M);let o=t.target;for(;o&&o.parentElement&&!o.classList.contains(v);)o=o.parentElement;let s=e._findCell(o);const n=k(t,o);if(-1===s){for(;o&&o.parentElement;){if(o.classList.contains(w.NODE_CLASS)){o.classList.add(M),o.dataset.mosaicDropSide=n;break}o=o.parentElement}o&&o.parentElement||(t.source.viewportNode.classList.add(M),t.source.viewportNode.dataset.mosaicDropSide="bottom")}else{const t=e.cellsArray[s];t.node.classList.add(M),t.node.dataset.mosaicDropSide=n}}(this,e),this._updateForDeferMode=this._myupdateForDeferMode,this.tiles.changed.connect(this.onTreeChanged,this)}onTreeChanged(e,t){w.prototype.onTreeChanged.bind(this)(e,t),console.log(this.tiles,w.showMosaic(this)),requestAnimationFrame(()=>this.update())}get model(){return super.model}set model(e){super.model=e,this.viewModel.itemsList=this.tiles}onCellInserted(e,t){super.onCellInserted(e,t),console.warn("ic",e,"Cell:"+t.prompt,t,t.model.metadata.mosaic),this.mosaicInsert(e)}onCellRemoved(e,t){super.onCellRemoved(e,t),console.warn("rc",e,"Cell:"+t.prompt,t);const[i]=this.getLeaf(e);if(null!==i){const[e,o]=i;o==t&&(e.tiles.removeValue(o),console.log("removed"))}}async _myupdateForDeferMode(e,t){const[i,o]=this.mosaicInsert(t);e.dataset.windowedListIndex=`${o}`,i.layout.insertWidget(o,e),await e.ready}graft(e,t,i,o,s,n=0){let r=i.superMosaic,l=i;for(let e=o.length;e>s;e--)l=r,r=l.superMosaic;let a=r.tiles.indexOf(l);if(a<0?(console.error("referrence leaf/branch missing!"),r=this,a=this.tiles.length):a+=n,s<t.length){const i=r.growBranch(t.slice(s),[a]);return i.splice(0,0,e),console.log("grafted","branch:"+i.path,"to",r.path,"at",a),[i,a]}return r.splice(a,0,e),console.log("grafted","Cell:"+e.prompt,"to",r.groupID,"at",a),[r,a]}mosaicInsert(e){var t,i;const o=this.cellsArray[e-1],s=this.cellsArray[e],n=this.cellsArray[e+1];w.setParent(s,null),s.parent=null;let r=(null===(t=null==o?void 0:o.superMosaic)||void 0===t?void 0:t.path)||[],l=w.getPath(s),a=(null===(i=null==n?void 0:n.superMosaic)||void 0===i?void 0:i.path)||[];if(0===e&&!n){const e=this.growBranch(l||[]);return e.splice(0,0,s),console.log("grafting initial cell",s,e),[e,0]}void 0===l&&(l=o?r:[]);let d=(null==o?void 0:o.superMosaic)?w.divergeDepth(r,l):-1,c=(null==n?void 0:n.superMosaic)?w.divergeDepth(a,l):-1;if(o&&o.superMosaic){let e=o;for(let t=d;t<r.length;t++)e=e.superMosaic,null==e||e.checkEmpty();r=o.superMosaic.path,d=o.superMosaic?w.divergeDepth(r,l):-1}if(n&&n.superMosaic){let e=n;for(let t=c;t<a.length;t++)e=e.superMosaic,null==e||e.checkEmpty();a=n.superMosaic.path,c=n.superMosaic?w.divergeDepth(a,l):-1}if(d<0&&c<0)throw new Error("both neighbors unattached! unable to graft");switch(Math.max(d,c)){case d:return this.graft(s,l,o,r,d,1);case c:return this.graft(s,l,n,a,c,0);default:throw new Error("invalid path divergence!")}}}const b=new l.LabIcon({name:"mosaic:favicon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" zoomAndPan="magnify" viewBox="0 0 224.87999 225" height="300" preserveAspectRatio="xMidYMid meet" version="1.0"><defs><clipPath id="c77da14a9c"><path d="M 5.695312 6.648438 L 218.421875 6.648438 L 218.421875 219.207031 L 5.695312 219.207031 Z M 5.695312 6.648438 " clip-rule="nonzero"/></clipPath><clipPath id="23beb3cc63"><path d="M 41.148438 41.0625 L 82.5625 41.0625 L 82.5625 112.921875 L 41.148438 112.921875 Z M 41.148438 41.0625 " clip-rule="nonzero"/></clipPath><clipPath id="16c2531e20"><path d="M 0.148438 0.0625 L 41.5625 0.0625 L 41.5625 71.921875 L 0.148438 71.921875 Z M 0.148438 0.0625 " clip-rule="nonzero"/></clipPath><clipPath id="29353f2a72"><rect x="0" width="42" y="0" height="72"/></clipPath><clipPath id="d8aae63389"><path d="M 116.046875 41.070312 L 185.339844 41.070312 L 185.339844 113 L 116.046875 113 Z M 116.046875 41.070312 " clip-rule="nonzero"/></clipPath><clipPath id="cfc5a793f8"><path d="M 185.339844 41.070312 L 185.339844 112.929688 L 150.691406 86.902344 L 116.046875 112.929688 L 116.046875 41.070312 Z M 185.339844 41.070312 " clip-rule="nonzero"/></clipPath><clipPath id="220cefa82e"><path d="M 0.046875 0.0703125 L 69.339844 0.0703125 L 69.339844 72 L 0.046875 72 Z M 0.046875 0.0703125 " clip-rule="nonzero"/></clipPath><clipPath id="3c90225054"><path d="M 69.339844 0.0703125 L 69.339844 71.929688 L 34.691406 45.902344 L 0.046875 71.929688 L 0.046875 0.0703125 Z M 69.339844 0.0703125 " clip-rule="nonzero"/></clipPath><clipPath id="d9c4b89bd7"><rect x="0" width="70" y="0" height="72"/></clipPath><clipPath id="c86cb4a01a"><path d="M 41.144531 140.367188 L 82.5625 140.367188 L 82.5625 182 L 41.144531 182 Z M 41.144531 140.367188 " clip-rule="nonzero"/></clipPath><clipPath id="a9614c8938"><path d="M 0.144531 0.367188 L 41.5625 0.367188 L 41.5625 42 L 0.144531 42 Z M 0.144531 0.367188 " clip-rule="nonzero"/></clipPath><clipPath id="61a8371438"><rect x="0" width="42" y="0" height="42"/></clipPath><clipPath id="ad4c9c5550"><path d="M 116.042969 140.371094 L 185.335938 140.371094 L 185.335938 182.003906 L 116.042969 182.003906 Z M 116.042969 140.371094 " clip-rule="nonzero"/></clipPath><clipPath id="414381d676"><path d="M 0.0429688 0.371094 L 69.335938 0.371094 L 69.335938 42.003906 L 0.0429688 42.003906 Z M 0.0429688 0.371094 " clip-rule="nonzero"/></clipPath><clipPath id="f52a3b91bf"><rect x="0" width="70" y="0" height="43"/></clipPath></defs><g clip-path="url(#c77da14a9c)"><path stroke-linecap="butt" transform="matrix(0, -0.7496, 0.7496, 0, 5.69527, 219.20806)" fill="none" stroke-linejoin="miter" d="M 0.00137291 0.0000562556 L 283.564089 0.0000562556 L 283.564089 283.78685 L 0.00137291 283.78685 Z M 0.00137291 0.0000562556 " stroke="#f7672c" stroke-width="52" stroke-opacity="1" stroke-miterlimit="4"/></g><g clip-path="url(#23beb3cc63)"><g transform="matrix(1, 0, 0, 1, 41, 41)"><g clip-path="url(#29353f2a72)"><g clip-path="url(#16c2531e20)"><path fill="#ffad31" d="M 0.148438 71.921875 L 0.148438 0.09375 L 41.5625 0.09375 L 41.5625 71.921875 Z M 0.148438 71.921875 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g><g clip-path="url(#d8aae63389)"><g clip-path="url(#cfc5a793f8)"><g transform="matrix(1, 0, 0, 1, 116, 41)"><g clip-path="url(#d9c4b89bd7)"><g clip-path="url(#220cefa82e)"><g clip-path="url(#3c90225054)"><path fill="#f7672c" d="M 0.046875 0.0703125 L 69.339844 0.0703125 L 69.339844 71.800781 L 0.046875 71.800781 Z M 0.046875 0.0703125 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g></g></g><g clip-path="url(#c86cb4a01a)"><g transform="matrix(1, 0, 0, 1, 41, 140)"><g clip-path="url(#61a8371438)"><g clip-path="url(#a9614c8938)"><path fill="#ff914d" d="M 0.144531 42 L 0.144531 0.425781 L 41.5625 0.425781 L 41.5625 42 Z M 0.144531 42 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g><g clip-path="url(#ad4c9c5550)"><g transform="matrix(1, 0, 0, 1, 116, 140)"><g clip-path="url(#f52a3b91bf)"><g clip-path="url(#414381d676)"><path fill="#ffad31" d="M 0.0429688 42.003906 L 0.0429688 0.371094 L 69.324219 0.371094 L 69.324219 42.003906 Z M 0.0429688 42.003906 " fill-opacity="1" fill-rule="nonzero"/></g></g></g></g></svg>'.toString()}),x="Mosaic Notebook";class _ extends s.NotebookModelFactory{get name(){return"mosaic-notebook"}}const S={id:"mosaic-lab:plugin",description:"Arrange Jupyter notebook cells in any way two-dimensionally. Present your code compactly in Zoom video confrences. Let your Jupyter notebook tell the story and be self-documenting in itself, like a poster presentation. Eliminate white space in your notebook and take advantage of unused screen real estate.",autoStart:!0,requires:[s.INotebookTracker,r.ILauncher,o.IEditorServices,a.IKernelSpecManager,d.ILayoutRestorer],optional:[],activate:async(e,t,i,o,r,l)=>{console.log("JupyterLab extension mosaic-lab is activated!");const a=e.docRegistry.getWidgetFactory("Notebook");function d(e,i){const o=i.context.path;void 0!==t.find(e=>e.context.path==o)&&(n.showDialog,n.Dialog)}const c=new _({disableDocumentWideUndoRedo:!1});e.docRegistry.addModelFactory(c);const h=new s.NotebookWidgetFactory({name:x,fileTypes:["notebook"],defaultFor:["notebook"],modelName:"mosaic-notebook",preferKernel:!0,canStartKernel:!0,rendermime:a.rendermime,contentFactory:new y.ContentFactory({editorFactory:o.factoryService.newInlineEditor}),mimeTypeService:a.mimeTypeService,toolbarFactory:a._toolbarFactory});h.widgetCreated.connect((e,i)=>{t.add(i),i.title.icon=b}),h.widgetCreated.connect(d),a.widgetCreated.connect(d),e.docRegistry.addWidgetFactory(h),e.docRegistry.setDefaultWidgetFactory("notebook",x),l&&h.widgetCreated.connect((e,t)=>{var i;const o=t.context.path;t.id=`mosaic-notebook-${o}`,t.title.icon=b,t.title.label=null!==(i=o.split("/").pop())&&void 0!==i?i:o,console.warn("SETTING RESTORER",o,t.id,t.title),l.add(t,o)});for(const t of e.docRegistry.widgetExtensions("Notebook"))e.docRegistry.addWidgetExtension(x,t);e.commands.addCommand("mosaic-notebook:create-new",{label:t=>{var i,o;return`[Mosaic] ${(null===(o=null===(i=e.serviceManager.kernelspecs.specs)||void 0===i?void 0:i.kernelspecs[t.kernelName])||void 0===o?void 0:o.display_name)||""}`},caption:"Create a new Mosaic Notebook",execute:async({kernelName:t})=>{const i=await e.commands.execute("docmanager:new-untitled",{type:"notebook"});return e.commands.execute("docmanager:open",{path:i.path,factory:x,kernel:{name:t}})},icon:b,iconLabel:"Mosaic Notebook"});for(const t in e.serviceManager.kernelspecs.specs.kernelspecs){const o=e.serviceManager.kernelspecs.specs.kernelspecs[t];i.add({command:"mosaic-notebook:create-new",args:{kernelName:t},category:"Notebook",rank:0,kernelIconUrl:`${o.resources["logo-svg"]}`})}}}}}]);